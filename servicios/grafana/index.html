<!DOCTYPE html><html lang="es" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Juan Si茅cola">
      
      
      
        <link rel="prev" href="../bastion/">
      
      
        <link rel="next" href="../kuma/">
      
      
        
      
      
      <link rel="icon" href="../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Grafana &amp; Prometheus - Juanes Home Lab</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#grafana-prometheus" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Juanes Home Lab" class="md-header__button md-logo" aria-label="Juanes Home Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M348.8 32C340.7 46.1 336 62.5 336 80v16H64v224h272v64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64zM336 432c0 17.5 4.7 33.9 12.8 48H120c-13.3 0-24-10.7-24-24s10.7-24 24-24zm96-400h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48m24 64c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm56 144a32 32 0 1 0-64 0 32 32 0 1 0 64 0"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Juanes Home Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Grafana &amp; Prometheus
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B煤squeda" placeholder="B煤squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b煤squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Pesta帽as" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  隆Bienvenido a Juanes Home Lab! 

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../AWS/aws/" class="md-tabs__link">
          
  
  
  AWS

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../OCI/oci/" class="md-tabs__link">
          
  
  
  OCI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../dispositivos/" class="md-tabs__link">
          
  
  
  Dispositivos

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Servicios

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../topologia/diagrama/" class="md-tabs__link">
          
  
  
  Topologia

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegaci贸n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Juanes Home Lab" class="md-nav__button md-logo" aria-label="Juanes Home Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M348.8 32C340.7 46.1 336 62.5 336 80v16H64v224h272v64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64zM336 432c0 17.5 4.7 33.9 12.8 48H120c-13.3 0-24-10.7-24-24s10.7-24 24-24zm96-400h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48m24 64c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm56 144a32 32 0 1 0-64 0 32 32 0 1 0 64 0"></path></svg>

    </a>
    Juanes Home Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    隆Bienvenido a Juanes Home Lab! 
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AWS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    AWS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Reverse Proxy con NPM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    OCI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    OCI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OCI/oci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoreo con Grafana y Prometheus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dispositivos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dispositivos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inventario de Dispositivos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2">
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Firewall
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/firewall/jpfw01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JPFW01 (PfSense)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3">
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Routers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Routers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/routers/jpro01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JPROO1 (VyOS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/routers/jpro02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JPROO2 (Cisco)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4">
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Servidores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Servidores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/servidores/JDATSR01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JDATSR01 (Debian 12 Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/servidores/JDCSR01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JDCSR01 (Debian 12 Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/servidores/JDEVSR01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JDEVSR01 (Debian 12 Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/servidores/JJUMSR01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JJUMSR01 (Debian 12 Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5">
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Switches
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Switches
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/switches/jpswa01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JPSWA01 (Cisco Acceso)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dispositivos/switches/jpswc01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n: JPSWC01 (Cisco Core)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Servicios
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Servicios
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servicios de Gesti贸n y Monitoreo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bastion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bastion (Jump Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Grafana &amp; Prometheus
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana &amp; Prometheus
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#arquitectura-de-red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arquitectura de Red
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pasos-que-realice-para-la-configuracion-e-implementacion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pasos que realic茅 para la configuraci贸n e implementaci贸n
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pasos que realic茅 para la configuraci贸n e implementaci贸n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#informacion-del-sistema-y-red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Informaci贸n del Sistema y Red
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interfaces-y-trafico-comun-para-ambos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interfaces y Tr谩fico (Com煤n para ambos)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulo-vyos-linux-nix_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        M贸dulo VyOS / Linux (nix_device)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulo-cisco-cisco_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        M贸dulo Cisco (cisco_device)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-nombre-del-dispositivo-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Nombre del Dispositivo Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-tiempo-de-encendido-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Tiempo de Encendido Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-pico-maximo-de-trafico-de-salida-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Pico M谩ximo de Tr谩fico de Salida Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gauge-uso-de-cpu-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gauge - Uso de CPU Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gauge-uso-de-memoria-ram-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gauge - Uso de Memoria RAM Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-series-trafico-de-red-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Time series - Tr谩fico de Red Panel
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusi贸n
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kuma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uptime Kuma (Monitoreo)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../netbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NetBox (Source of Truth)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../samba/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Samba AD DC (Identity Provider)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Topologia
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Topologia
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologia/diagrama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diagrama General de la Topolog铆a
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologia/direccionamiento/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Direccionamiento
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologia/direcciones-ip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Direccionamiento IP por Interfaz
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologia/routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Protocolos de Enrutamiento
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologia/vlans/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci贸n de VLANs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#arquitectura-de-red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arquitectura de Red
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pasos-que-realice-para-la-configuracion-e-implementacion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pasos que realic茅 para la configuraci贸n e implementaci贸n
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pasos que realic茅 para la configuraci贸n e implementaci贸n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#informacion-del-sistema-y-red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Informaci贸n del Sistema y Red
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interfaces-y-trafico-comun-para-ambos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interfaces y Tr谩fico (Com煤n para ambos)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulo-vyos-linux-nix_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        M贸dulo VyOS / Linux (nix_device)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulo-cisco-cisco_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        M贸dulo Cisco (cisco_device)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-nombre-del-dispositivo-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Nombre del Dispositivo Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-tiempo-de-encendido-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Tiempo de Encendido Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat-pico-maximo-de-trafico-de-salida-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stat - Pico M谩ximo de Tr谩fico de Salida Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gauge-uso-de-cpu-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gauge - Uso de CPU Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gauge-uso-de-memoria-ram-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gauge - Uso de Memoria RAM Panel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-series-trafico-de-red-panel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Time series - Tr谩fico de Red Panel
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusi贸n
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navegaci贸n">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    隆Bienvenido a Juanes Home Lab! 
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Servicios
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="grafana-prometheus"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 1.5a6.5 6.5 0 1 0 6.016 4.035.75.75 0 0 1 1.388-.57 8 8 0 1 1-4.37-4.37.75.75 0 1 1-.569 1.389A6.5 6.5 0 0 0 8 1.5m6.28.22a.75.75 0 0 1 0 1.06l-4.063 4.064a2.5 2.5 0 1 1-1.06-1.06L13.22 1.72a.75.75 0 0 1 1.06 0M7 8a1 1 0 1 0 2 0 1 1 0 0 0-2 0"></path></svg></span> Grafana &amp; Prometheus</h1>
<blockquote>
<p><strong>URL de Acceso:</strong> <code>https://grafana.js-lab-uy.duckdns.org</code></p>
</blockquote>
<p>Este stack proporciona <strong>Observabilidad</strong> de la red. A diferencia de Uptime Kuma (que solo verifica si un equipo responde), este sistema recolecta m茅tricas hist贸ricas detalladas: consumo de ancho de banda, carga de CPU por n煤cleo, uso de memoria RAM y estabilidad de las peticiones SNMP.</p>
<p>Este servicio se ejecuta en una instancia de <strong>Oracle Cloud Infrastructure (OCI)</strong>, fuera de la red local en GNS3 del laboratorio.</p>
<p>La conexi贸n con los dispositivos locales se realiza a trav茅s de un t煤nel <strong>Tailscale</strong>.</p>
<h2 id="arquitectura-de-red"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M0 80c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v16h128V80c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48v-16H192v16c0 7.3-1.7 14.3-4.6 20.5L256 288h80c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48v-96c0-7.3 1.7-14.3 4.6-20.5L128 224H48c-26.5 0-48-21.5-48-48z"></path></svg></span> Arquitectura de Red</h2>
<ul>
<li><strong>No hay puertos expuestos a Internet:</strong> Los puertos 3000 (Grafana) y 9090 (Prometheus) no est谩n abiertos en el firewall de Oracle.</li>
<li><strong>Acceso P煤blico y VPN:</strong> Para ver los dashboards en grafana se expone publicamente el endpoint <code>https://grafana.js-lab-uy.duckdns.org</code>, mientras que para acceder a prometheus y snmp exporter, es obligatorio estar conectado a la red Tailscale.</li>
<li><strong>Recolecci贸n de Datos:</strong> Prometheus (en la nube) alcanza las IPs privadas de la LAN (<code>192.168.1.x</code>) enrutando el tr谩fico a trav茅s del nodo Tailscale local (Subnet Router).</li>
</ul>
<p><strong><em>Capturas de pantalla de los Switches (JPSWA01, JPSWC01) de la topolog铆a</em></strong></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/grafana-switchcore.png" data-desc-position="bottom"><img alt="grafana1" src="../../assets/grafana-switchcore.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/grafana-swtichacceso.png" data-desc-position="bottom"><img alt="grafana2" src="../../assets/grafana-swtichacceso.png"></a></p>
<h2 id="pasos-que-realice-para-la-configuracion-e-implementacion">Pasos que realic茅 para la configuraci贸n e implementaci贸n</h2>
<p>Primero ejecutamos un apt update para actualizar los paquetes del sistema:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span>-y
</span></code></pre></div>
<p>Una vez actualizados los paquetes, ya podemos instalar tailscale desde la p谩gina oficial <a href="https://tailscale.com/download">https://tailscale.com/download</a>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="o">[</span>https://tailscale.com/install.sh<span class="o">](</span>https://tailscale.com/install.sh<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span></code></pre></div>
<p>Ahora podemos ejecutar el comando sudo tailscale up:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>tailscale<span class="w"> </span>up
</span></code></pre></div>
<p>Hacemos click en el enlace:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen0.png" data-desc-position="bottom"><img alt="imagen.png" src="../../assets/imagen0.png"></a></p>
<blockquote>
<p><em>Nos pedir谩 que ingresemos una cuenta personal y una vez seleccionada, nuestra m谩quina virtual de oracle estar谩 dentro de nuestra tailnet.</em></p>
</blockquote>
<p>Luego por la consola debemos aceptar las rutas que est谩 compartiendo/advirtiendo el firewall PfSense:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/subnet-tailscale-advertise-new.png" data-desc-position="bottom"><img alt="imagen.png3" src="../../assets/subnet-tailscale-advertise-new.png"></a></p>
<p>Aceptamos las rutas en la instancia de oracle con el comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>tailscale<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--accept-routes
</span></code></pre></div>
<p>Posteriormente ya podremos hacerle ping a la interfaz de loopback que tiene nuestro router JPRO02, de nuestra topolog铆a local en GNS3:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen3.png" data-desc-position="bottom"><img alt="imagen.png4" src="../../assets/imagen3.png"></a></p>
<p>Una vez actualizado el sistema e instalado tailscale debemos instalar el paquete <strong><code>snmp</code></strong>  que contiene la herramienta <code>snmpwalk</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>snmp
</span></code></pre></div>
<p>Entonces ahora si podemos utilizar la herramienta <code>snmpwalk</code>.</p>
<p>En un dispositivo remoto de nuestra red interna, por ejemplo el PfSense se parametriza as铆:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>snmpwalk<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">192</span>.168.1.1
</span></code></pre></div>
<ul>
<li><code>v</code>: Especifica la versi贸n de SNMP (1, 2c, o 3). En este caso configuramos en todos los equipos para que utilice la segunda versi贸n.</li>
<li><code>c</code>: La cadena comunitaria (community string), como <code>public</code> o <code>private</code>. En este caso es public.</li>
<li><code>IP_o_Hostname</code>: La direcci贸n del dispositivo a consultar.</li>
</ul>
<p>Luego de esto crearemos una carpeta donde estar谩n el archivo compose para snmp_exporter que desplegaremos con docker:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/docker/snmp-exporter
</span></code></pre></div>
<p>Ahora si ya podemos crear nuestro archivo docker-compose con cualquier editor de texto, y pegamos este fragmento en esta ruta /opt/docker/snmp-exporter:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">snmp-exporter</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp-exporter</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/snmp-exporter:v0.30.1</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9116:9116</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config:/etc/snmp-exporter</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--config.file=/etc/snmp-exporter/snmp.yml</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_network</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">  </span><span class="nt">monitoring_network</span><span class="p">:</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>Una vez guardado los cambios del docker-compose.yml, ahora podemos volver a nuestro directorio home y ya podemos clonar el repositorio con el proyecto llamado generador snmp, el cual nos ayudar谩 much铆simo para generar nuestra configuraci贸n SNMP que necesitamos para alimentar a nuestro contenedor:</p>
<p>Primero creamos un directorio y nos movemos a el:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>mkdir<span class="w"> </span>monitoring-snmp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>monitoring-snmp
</span></code></pre></div>
<p>Dentro de ese directorio clonamos el repositorio de github:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/prometheus/snmp_exporter.git
</span></code></pre></div>
<p>Una vez clonado el repositorio dentro de la carpeta snmp_exporter tendremos todo el c贸digo fuente para el generador, aunque primero necesitaremos instalar algunas dependencias para poder compilar el generador:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>unzip<span class="w"> </span>build-essential<span class="w"> </span>libsnmp-dev<span class="w"> </span>-y
</span></code></pre></div>
<p>Nos movemos a la carpeta generator ahora:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">cd</span><span class="w"> </span>generator
</span></code></pre></div>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen4.png" data-desc-position="bottom"><img alt="imagen.png5" src="../../assets/imagen4.png"></a></p>
<p>Ahora ya podemos  compilar el generador y procesar los MIBs. Para entender la importancia de esto, pensemos en los <strong>MIBs</strong>  como si fueran el sistema DNS de las redes o un diccionario de traducci贸n.</p>
<blockquote>
<p>Los dispositivos de red se comunican internamente utilizando <strong>OIDs (Object Identifiers)</strong>, que son largas cadenas num茅ricas jer谩rquicas dif铆ciles de memorizar para un humano. Los archivos MIB act煤an como un mapa que traduce esas cadenas num茅ricas a nombres legibles (por ejemplo, traduce <code>.1.3.6.1.2.1.1.5.0</code> a <code>sysName</code>). Al compilar los MIBs, permitimos que el generador entienda qu茅 m茅tricas estamos solicitando por su nombre y sepa exactamente qu茅 direcci贸n num茅rica pedirle al dispositivo. Esto nos ayuda a trabajar 煤nicamente con los <strong>nombres de las m茅tricas definidos en los MIBs</strong>, sin necesidad de memorizar o buscar manualmente la compleja cadena num茅rica de cada OID.</p>
</blockquote>
<p>Entonces se ejecuta el siguiente comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>make<span class="w"> </span>generator<span class="w"> </span>mibs
</span></code></pre></div>
<p>Entonces cuando tengamos el compilador en funcionamiento, ya podremos generar nuestra configuraci贸n SNMP, se crear谩 un binario.</p>
<p>En caso de que tire un error como este por ejemplo:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen5.png" data-desc-position="bottom"><img alt="imagen.png6" src="../../assets/imagen5.png"></a></p>
<p>Primero verificamos si tenemos go instalado, en caso que no, lo instalamos:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen6.png" data-desc-position="bottom"><img alt="imagen.png7" src="../../assets/imagen6.png"></a></p>
<p>Y para eso lo que hacemos es descargar la versi贸n 1.23.5 utilizando wget, es necesaria esa versi贸n para garantizar la compatibilidad con el c贸digo del repositorio:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>wget<span class="w"> </span>https://go.dev/dl/go1.23.5.linux-amd64.tar.gz
</span></code></pre></div>
<p>Entonces lo descomprimimos ahora:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>tar<span class="w"> </span>-C<span class="w"> </span>/usr/local<span class="w"> </span>-xzf<span class="w"> </span>go1.23.5.linux-amd64.tar.gz
</span></code></pre></div>
<p>Agregamos /usr/local/go/bin a la variable de entorno PATH:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/go/bin
</span></code></pre></div>
<p>Y si escribimos go version nos mostrar谩 la version instalada:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>ubuntu@JMONSR02:~/monitoring-snmp/snmp_exporter/generator$<span class="w"> </span>go<span class="w"> </span>version
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>go<span class="w"> </span>version<span class="w"> </span>go1.24.0<span class="w"> </span>linux/amd64
</span></code></pre></div>
<p>Una vez instalado go, ya podremos lanzar de nuevo el comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>make<span class="w"> </span>generator<span class="w"> </span>mibs
</span></code></pre></div>
<p>El cu谩l nos generar谩 el binario compilado y listo para usar:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen7.png" data-desc-position="bottom"><img alt="imagen.png8" src="../../assets/imagen7.png"></a></p>
<p>Ahora ya podemos crear nuestra configuraci贸n SNMP, editando el archivo generator.yml, por las dudas hacemos una copia de ese archivo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>cp<span class="w"> </span>generator.yml<span class="w"> </span>generator.yml.bkp
</span></code></pre></div>
<p>Lo editamos con cualquier editor de texto:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen8.png" data-desc-position="bottom"><img alt="imagen.png9" src="../../assets/imagen8.png"></a></p>
<p>En nuestro caso podemos dejar la autenticaci贸n por defecto que ya trae, para este caso configuramos la versi贸n 2 para todos los dispositivos de la red.</p>
<p>Entonces debemos establecer el recorrido y poner las m茅tricas espec铆ficas que se quieran obtener, por ejemplo:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/modules-snmp-exporter.png" data-desc-position="bottom"><img alt="imagen.png10" src="../../assets/modules-snmp-exporter.png"></a></p>
<div class="language-yaml highlight"><span class="filename">generator.yml</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nn">---</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nt">auths</span><span class="p">:</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="nt">public_v2</span><span class="p">:</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="nt">modules</span><span class="p">:</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="c1"># MDULO PARA VyOS, pfSense y Linux</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="nt">nix_device</span><span class="p">:</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nt">walk</span><span class="p">:</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"SNMPv2-MIB::sysUpTime"</span><span class="w">              </span><span class="c1"># UpTime</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"SNMPv2-MIB::sysName"</span><span class="w">                </span><span class="c1"># Name</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"IF-MIB::ifXTable"</span><span class="w">                   </span><span class="c1"># 64 bits meter</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"HOST-RESOURCES-MIB::hrProcessorLoad"</span><span class="w"> </span><span class="c1"># CPU load</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"HOST-RESOURCES-MIB::hrStorageTable"</span><span class="w">  </span><span class="c1"># RAM, Disks</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_indexes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ifIndex</span><span class="p p-Indicator">]</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">        </span><span class="nt">lookup</span><span class="p">:</span><span class="w"> </span><span class="s">"IF-MIB::ifName"</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_indexes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ifIndex</span><span class="p p-Indicator">]</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">        </span><span class="nt">lookup</span><span class="p">:</span><span class="w"> </span><span class="s">"IF-MIB::ifAlias"</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_indexes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">hrStorageIndex</span><span class="p p-Indicator">]</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">        </span><span class="nt">lookup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hrStorageDescr</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">        </span><span class="nt">drop_source_indexes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="nt">overrides</span><span class="p">:</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">      </span><span class="nt">ifAlias</span><span class="p">:</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">      </span><span class="nt">ifDescr</span><span class="p">:</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">      </span><span class="nt">ifName</span><span class="p">:</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">  </span><span class="c1"># MDULO PARA EQUIPOS CISCO (Router y Switch)</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">  </span><span class="nt">cisco_device</span><span class="p">:</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">    </span><span class="nt">walk</span><span class="p">:</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"SNMPv2-MIB::sysUpTime"</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"SNMPv2-MIB::sysName"</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"IF-MIB::ifXTable"</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"CISCO-PROCESS-MIB::cpmCPUTotal5minRev"</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"CISCO-MEMORY-POOL-MIB::ciscoMemoryPoolFree"</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"CISCO-MEMORY-POOL-MIB::ciscoMemoryPoolUsed"</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"OLD-CISCO-SYS-MIB::avgBusy5"</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"OLD-CISCO-SYS-MIB::freeMem"</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_indexes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ifIndex</span><span class="p p-Indicator">]</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="w">        </span><span class="nt">lookup</span><span class="p">:</span><span class="w"> </span><span class="s">"IF-MIB::ifName"</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_indexes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ifIndex</span><span class="p p-Indicator">]</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="w">        </span><span class="nt">lookup</span><span class="p">:</span><span class="w"> </span><span class="s">"IF-MIB::ifAlias"</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="w">    </span><span class="nt">overrides</span><span class="p">:</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="w">      </span><span class="nt">ifAlias</span><span class="p">:</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="w">      </span><span class="nt">ifDescr</span><span class="p">:</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="w">      </span><span class="nt">ifName</span><span class="p">:</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a><span class="w">        </span><span class="nt">ignore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Lookup metric</span>
</span></code></pre></div>
<p>donde cada una tiene un significado en especial:</p>
<h3 id="informacion-del-sistema-y-red">Informaci贸n del Sistema y Red</h3>
<ul>
<li><strong>sysUpTime</strong>: Tiempo encendido (dispositivo).</li>
<li><strong>sysName</strong>: Nombre de host configurado en el dispositivo.</li>
</ul>
<h3 id="interfaces-y-trafico-comun-para-ambos">Interfaces y Tr谩fico (Com煤n para ambos)</h3>
<ul>
<li>
<p><strong>ifXTable</strong>: Tabla extendida de interfaces.</p>
<blockquote>
<p>Nota: Al traer esta tabla, obtienes autom谩ticamente <code>ifHCInOctets</code> y <code>ifHCOutOctets</code> (los contadores de 64 bits necesarios para medir velocidades de 1Gbps o m谩s sin errores).</p>
<p>Tambi茅n trae: <code>ifName</code> (Nombre de la interfaz) y <code>ifAlias</code> (Descripci贸n de la interfaz).</p>
</blockquote>
</li>
<li>
<p><strong>ifHCInOctets</strong>: Tr谩fico entrante (bytes).</p>
</li>
<li><strong>ifHCOutOctets</strong>: Tr谩fico saliente (bytes).</li>
<li><strong>ifName</strong>: Nombre de la interfaz.</li>
<li><strong>ifAlias</strong>: Descripci贸n de la interfaz.</li>
</ul>
<h3 id="modulo-vyos-linux-nix_device">M贸dulo VyOS / Linux (nix_device)</h3>
<ul>
<li>
<p><strong>hrProcessorLoad</strong>: Carga del procesador.</p>
<ul>
<li><strong>Detalle:</strong> Muestra el % de uso de cada n煤cleo de la CPU individualmente.</li>
</ul>
</li>
<li>
<p><strong>hrStorageTable</strong>: Tabla de almacenamiento unificada.</p>
<ul>
<li><strong>Detalle:</strong> En Linux/VyOS, esto incluye tanto Discos Duros (sistema de archivos) como Memoria RAM (Physical memory). Por eso usamos filtros luego para separarlos.</li>
</ul>
</li>
</ul>
<h3 id="modulo-cisco-cisco_device">M贸dulo Cisco (cisco_device)</h3>
<ul>
<li>
<p><strong>cpmCPUTotal5minRev</strong>: Uso de CPU (Cisco Moderno).</p>
<ul>
<li><strong>Detalle:</strong> Promedio de uso de CPU en los 煤ltimos 5 minutos (Est谩ndar recomendado para Cisco).</li>
</ul>
</li>
<li>
<p><strong>ciscoMemoryPoolFree</strong>: Memoria Libre (Cisco Moderno).</p>
<ul>
<li><strong>Detalle:</strong> Cantidad de bytes libres en el pool de memoria.</li>
</ul>
</li>
<li>
<p><strong>ciscoMemoryPoolUsed</strong>: Memoria Usada (Cisco Moderno).</p>
<ul>
<li><strong>Detalle:</strong> Cantidad de bytes ocupados.</li>
</ul>
</li>
<li>
<p><strong>avgBusy5</strong>: Uso de CPU (Cisco Legacy).</p>
<ul>
<li><strong>Detalle:</strong> M茅trica antigua para routers viejos que no soportan la MIB moderna.</li>
</ul>
</li>
<li>
<p><strong>freeMem</strong>: Memoria Libre (Cisco Legacy).</p>
<ul>
<li><strong>Detalle:</strong> La m茅trica "vieja" para equipos que no soportan MemoryPool.</li>
</ul>
</li>
</ul>
<p>Ahora cerramos y guardamos el archivo, y ya podremos ejecutar el generador:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>./generator<span class="w"> </span>-m<span class="w"> </span>mibs<span class="w"> </span>generate
</span></code></pre></div>
<p>Esto nos generar谩 un archivo llamado snmp.yml:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen10.png" data-desc-position="bottom"><img alt="imagen.png11" src="../../assets/imagen10.png"></a></p>
<p>Bien entonces el siguiente paso es levantar el contenedor y la configuraci贸n, para eso volvemos al directorio: </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span>/opt/docker/snmp-exporter
</span></code></pre></div>
<p>Y antes de iniciar el contenedor, crearemos una carpeta llamada config:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>mkdir<span class="w"> </span>config<span class="w"> </span>
</span></code></pre></div>
<p>Luego, lo que hacemos es copiar el archivo snmp.yml que se gener贸 automaticamente a la ubicaci贸n actual, el directorio config:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/home/ubuntu/monitoring-snmp/snmp_exporter/generator/snmp.yml<span class="w">  </span>.
</span></code></pre></div>
<p>Ahora ya podemos crear la carpeta prometheus y su compose dentro de /opt/docker/:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>mkdir<span class="w"> </span>prometheus<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>prometheus
</span></code></pre></div>
<p>Creamos el archivo docker-compose.yml utilizando cualquier editor de texto, y pegamos lo siguiente:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:v3.9.1</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090:9090</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus:/etc/prometheus</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus-data:/prometheus</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">"--config.file=/etc/prometheus/prometheus.yml"</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_network</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="nt">monitoring_network</span><span class="p">:</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_network</span>
</span></code></pre></div>
<p>Luego creamos una carpeta llamada prometheus-data:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>mkdir<span class="w"> </span>prometheus-data
</span></code></pre></div>
<p>Le otorgamos permisos de lectura, escritura y ejecuci贸n:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>prometheus-data
</span></code></pre></div>
<p>Y ahora dentro de /opt/docker/prometheus, creamos otra carpeta prometheus que contendr谩 el prometheus.yml:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>mkdir<span class="w"> </span>prometheus<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>prometheus
</span></code></pre></div>
<p>Posteriormente utilizando creamos el archivo prometheus.yml y pegamos el siguiente contenido:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">global</span><span class="p">:</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nt">scrape_configs</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="c1"># JOB 1: Equipos VyOS y PfSense</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">'Vyos</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">PfSense'</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span><span class="w">      </span><span class="c1"># Escanea cada 1 minuto (menos carga al CPU de GNS3)</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="nt">scrape_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class="w">       </span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.255.255.1</span><span class="w">  </span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span><span class="w">   </span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/snmp</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="nt">params</span><span class="p">:</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">public_v2</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">      </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">nix_device</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__address__</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__param_target</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__param_target</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__address__</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">        </span><span class="nt">replacement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp-exporter:9116</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">  </span><span class="c1"># JOB 2: Equipos Cisco</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">'Router</span><span class="nv"> </span><span class="s">Cisco'</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.255.255.2</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/snmp</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="w">    </span><span class="nt">params</span><span class="p">:</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">public_v2</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">      </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">cisco_device</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__address__</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__param_target</span>
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__param_target</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__address__</span>
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="w">        </span><span class="nt">replacement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp-exporter:9116</span>
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a>
</span><span id="__span-29-42"><a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a><span class="c1"># JOB 3: Equipos Cisco</span>
</span><span id="__span-29-43"><a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">'Switches</span><span class="nv"> </span><span class="s">Cisco'</span>
</span><span id="__span-29-44"><a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a><span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span><span class="w">      </span>
</span><span id="__span-29-45"><a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a><span class="w">    </span><span class="nt">scrape_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class="w">       </span>
</span><span id="__span-29-46"><a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-29-47"><a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span>
</span><span id="__span-29-48"><a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.99.10</span>
</span><span id="__span-29-49"><a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.99.20</span>
</span><span id="__span-29-50"><a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/snmp</span>
</span><span id="__span-29-51"><a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a><span class="w">    </span><span class="nt">params</span><span class="p">:</span>
</span><span id="__span-29-52"><a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">public_v2</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-53"><a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a><span class="w">      </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">cisco_device</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-54"><a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a><span class="w">    </span><span class="nt">relabel_configs</span><span class="p">:</span>
</span><span id="__span-29-55"><a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__address__</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-56"><a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__param_target</span>
</span><span id="__span-29-57"><a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__param_target</span><span class="p p-Indicator">]</span>
</span><span id="__span-29-58"><a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a><span class="w">        </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instance</span>
</span><span id="__span-29-59"><a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__address__</span>
</span><span id="__span-29-60"><a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a><span class="w">        </span><span class="nt">replacement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp-exporter:9116</span>
</span></code></pre></div>
<p>Una vez guardado ahora ya podemos levantar el contenedor utilizando docker-compose:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>
</span></code></pre></div>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen12.png" data-desc-position="bottom"><img alt="imagen.png13" src="../../assets/imagen12.png"></a></p>
<p>Ahora se encuentra en ejecuci贸n, y podemos ingresar a la interfaz gr谩fica utilizando la ip que nos proporciona tailscale e indicamos el puerto 9090 que est谩 escuchando nuestro contenedor de prometheus <code>http://100.103.72.38:9090/</code>: </p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen13.png" data-desc-position="bottom"><img alt="imagen.png14" src="../../assets/imagen13.png"></a></p>
<p>Posteriormente ahora tambi茅n ya podemos levantar el contenedor snmp_exporter que creamos en pasos anteriores:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen14.png" data-desc-position="bottom"><img alt="imagen.png15" src="../../assets/imagen14.png"></a></p>
<p>Tambi茅n podemos ingresar a la p谩gina con la ip de tailscale y el puerto 9116 <code>http://100.103.72.38:9090/</code></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/snmp_exporter.png" data-desc-position="bottom"><img alt="imagen.png17" src="../../assets/snmp_exporter.png"></a></p>
<p>Ahora en este paso incluso ya podemos probar si estamos obteniendo las m茅tricas, entonces en target ponemos la ip de nuestro dispositivo por ejemplo 10.255.255.2 (JPRO02), en auth dejamos el public_v2 que qued贸 definido desde un principio y en m贸dulo escribimos cisco_device:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/cisco-device-snmp.png" data-desc-position="bottom"><img alt="imagen.png17" src="../../assets/cisco-device-snmp.png"></a></p>
<p>Entonces cuando le damos a Submit, nos devuelve un bloque de los datos que est谩 obteniendo, esto es un peque帽o fragmento de las m茅tricas que estamos obteniendo de nuestro router.</p>
<p>Una vez que eso est谩 funcionando ya podemos volver a la carpeta /opt/docker/ y dentro de ella crearemos una llamada Grafana:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>mkdir<span class="w"> </span>grafana<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>grafana<span class="w"> </span>
</span></code></pre></div>
<p>Dentro de ella creamos nuestro archivo docker-compose.yml utilizando nano o vim, y pegamos el siguiente contenido:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:12.4.0-20904407122-ubuntu</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'3000:3000'</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">      </span><span class="nt">GF_RENDERING_SERVER_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://grafana-image-renderer:8081/render</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">      </span><span class="nt">GF_RENDERING_CALLBACK_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://grafana:3000/</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-storage:/var/lib/grafana</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_network</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">  </span><span class="nt">grafana-storage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">  </span><span class="nt">monitoring_network</span><span class="p">:</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>Listo, ahora si podremos levantar nuestro contenedor con la herramienta <code>docker-compose up</code>:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen17.png" data-desc-position="bottom"><img alt="imagen.png18" src="../../assets/imagen17.png"></a></p>
<p>Ingresando con la ip de tailscale y el puerto 3000 que est谩 escuchando el contenedor de grafana, podremos acceder al dashboard desde un navegador:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen18.png" data-desc-position="bottom"><img alt="imagen.png19" src="../../assets/imagen18.png"></a></p>
<p>Ahora es el momento de crear los paneles con graficas, gauge y stats, de nuesotro firewall PfSense en este caso, para eso primero debemos linkear Prometheus como fuente de datos, osea conectar Prometheus como fuente de datos en Grafana.</p>
<p>Hacemos click en data sources:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen19.png" data-desc-position="bottom"><img alt="imagen.png20" src="../../assets/imagen19.png"></a></p>
<p>Ahora clickeamos el bot贸n azul que dice Add data source:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen20.png" data-desc-position="bottom"><img alt="imagen.png21" src="../../assets/imagen20.png"></a></p>
<p>Elegimos Prometheus:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen21.png" data-desc-position="bottom"><img alt="imagen.png22" src="../../assets/imagen21.png"></a></p>
<p>y en la ventana que se nos abre, en el campo connection debemos poner el nombre del contenedor de prometheus que definimos en su archivo docker-compose.yml, y tambi茅n indicamos el puerto, en este caso 9090:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/grafana-prometheus.png" data-desc-position="bottom"><img alt="imagen.png23" src="../../assets/grafana-prometheus.png"></a></p>
<p>y si hacemos click en el bot贸n save &amp; test:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen23.png" data-desc-position="bottom"><img alt="imagen.png24" src="../../assets/imagen23.png"></a></p>
<p>Como podemos ver ya qued贸 establecido prometheus como fuente de datos, ahora solo queda constuir el panel para el firewall pfsense.</p>
<p>Ahora hacemos click en Dashboards y le damos en new:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen24.png" data-desc-position="bottom"><img alt="imagen.png25" src="../../assets/imagen24.png"></a></p>
<p>le damos click en new visualization:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen25.png" data-desc-position="bottom"><img alt="imagen.png26" src="../../assets/imagen25.png"></a></p>
<p>aqu铆 seleccionamos prometheus como la fuente de datos:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/imagen26.png" data-desc-position="bottom"><img alt="imagen.png27" src="../../assets/imagen26.png"></a></p>
<p>bien, ahora ya podemos comenzar a crear un panel, comenzaremos con el nombre del dispositivo, en este ejemplo lo haremos para el router cisco JPRO02 de la topolog铆a:</p>
<h3 id="stat-nombre-del-dispositivo-panel">Stat - Nombre del Dispositivo Panel</h3>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-name.png" data-desc-position="bottom"><img alt="JPRO02-name" src="../../assets/JPRO02-name.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Stat</strong></li>
</ul>
<p>Panel Options -&gt; Title</p>
<ul>
<li><strong>Name</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">sysName</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span>
</span></code></pre></div>
<p>Options -&gt; Legend</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>{{sysName}}
</span></code></pre></div>
<hr>
<h3 id="stat-tiempo-de-encendido-panel">Stat - Tiempo de Encendido Panel</h3>
<p>Luego para el tiempo de encendido el panel es el siguiente:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-uptime.png" data-desc-position="bottom"><img alt="JPRO02-uptime" src="../../assets/JPRO02-uptime.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Stat</strong></li>
</ul>
<p>Panel Options -&gt; Title</p>
<ul>
<li><strong>UpTime</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nv">sysUpTime</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span>
</span></code></pre></div>
<blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>aqui se multiplica por 10 porque en SNMP viene en centesimas por segundos,
multiplicar por 10 lo convierte en mil茅simas (Milisegundos).</p>
</div>
</blockquote>
<p>Standard options -&gt; unit -&gt; milliseconds (ms)</p>
<hr>
<h3 id="stat-pico-maximo-de-trafico-de-salida-panel">Stat - Pico M谩ximo de Tr谩fico de Salida Panel</h3>
<p>Ahora crearemos un panel que nos muestra el pico de salida (subida), m谩ximo del router que tuvo en el promedio de 2 minutos</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-max.png" data-desc-position="bottom"><img alt="JPRO02-max" src="../../assets/JPRO02-max.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Stat</strong></li>
</ul>
<p>Panel Options -&gt; Title</p>
<ul>
<li><strong>Max Outbound Traffic</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kr">max_over_time</span><span class="o">(</span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">ifHCOutOctets</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}[</span><span class="s">2m</span><span class="p">]</span><span class="o">))</span><span class="p">[</span><span class="err">$__range:</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span>
</span></code></pre></div>
<blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esta query toma la velocidad de salida de todas las interfaces sumadas, busca el pico m谩s alto registrado en el periodo de tiempo seleccionado y lo multiplica por 8 para mostrarlo en Bits por segundo.</p>
</div>
</blockquote>
<p>Standard options -&gt; unit -&gt; bytes (SI)</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Para el panel que muestra el m谩ximo de pico de entrada se hace exactamente igual, solo que en la consulta se utiliza la siguiente: 
<code>max_over_time(sum(rate(ifHCInOctets{instance="10.255.255.2"}[2m]))[$__range:]) * 8</code></p>
</div>
<hr>
<h3 id="gauge-uso-de-cpu-panel">Gauge - Uso de CPU Panel</h3>
<p>Ahora crearemos el panel para ver el uso de la CPU del router</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-cpu.png" data-desc-position="bottom"><img alt="JPRO02-cpu" src="../../assets/JPRO02-cpu.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Gauge</strong></li>
</ul>
<p>Panel Options  Title</p>
<ul>
<li><strong>CPU Usage</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nv">cpmCPUTotal5minRev</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esta m茅trica representa el porcentaje de uso total de CPU, calculado como un promedio inverso de los 煤ltimos 5 minutos para el dispositivo con IP 10.255.255.2.
El valor devuelto ya se encuentra normalizado en un rango de 0 a 100, por lo que es ideal para visualizarse directamente en un Gauge.</p>
</div>
<p>Standard options -&gt; unit -&gt; Percent (0-100)</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Al utilizar la unidad Percent (0-100), Grafana ajusta autom谩ticamente la visualizaci贸n del gauge para representar correctamente el consumo de CPU, permitiendo adem谩s definir umbrales (thresholds) visuales para estados normales, de advertencia o cr铆ticos.</p>
</div>
<p>Thresholds</p>
<ul>
<li> <strong>Verde</strong>: 70 %</li>
<li> <strong>Amarillo</strong>: 75  %</li>
<li> <strong>Rojo</strong>: 90 %</li>
</ul>
<p>Esta configuraci贸n permite identificar r谩pidamente estados de carga elevada de CPU.</p>
<hr>
<h3 id="gauge-uso-de-memoria-ram-panel">Gauge - Uso de Memoria RAM Panel</h3>
<p>Posteriormente agregaremos un panel para ver el uso de memoria ram del dispositivo</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-ram.png" data-desc-position="bottom"><img alt="Memory-Usage" src="../../assets/JPRO02-ram.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Gauge</strong></li>
</ul>
<p>Panel Options  Title</p>
<ul>
<li><strong>Memory Usage</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="mi">100</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">sum</span><span class="o">(</span><span class="nv">ciscoMemoryPoolUsed</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span><span class="o">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="o">/</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="k">sum</span><span class="o">(</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="nv">ciscoMemoryPoolUsed</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span><span class="o">+</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span><span class="nv">ciscoMemoryPoolFree</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="o">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esta consulta calcula el porcentaje de uso de memoria del dispositivo con IP 10.255.255.2- La f贸rmula funciona de la siguiente manera:</p>
</div>
<ul>
<li>Se suma toda la memoria <strong>usada</strong> (<code>ciscoMemoryPoolUsed</code>)</li>
<li>Se suma la memoria <strong>total</strong>, compuesta por memoria usada + libre</li>
<li>El resultado se multiplica por <strong>100</strong> para obtener el valor en porcentaje</li>
</ul>
<p>El valor final queda normalizado en un rango de <strong>0 a 100</strong>, ideal para visualizaci贸n en un panel <strong>Gauge</strong>.</p>
<p>Standard options
Unit -&gt; Percent (0-100)</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Al utilizar la unidad Percent (0-100), Grafana interpreta correctamente los valores como porcentaje, permitiendo adem谩s aplicar umbrales visuales para identificar estados normales, de advertencia o cr铆ticos en el consumo de memoria.</p>
</div>
<p>Thresholds</p>
<ul>
<li> <strong>Verde</strong>: 70 %</li>
<li> <strong>Amarillo</strong>: 75  %</li>
<li> <strong>Rojo</strong>: 90 %</li>
</ul>
<p>Estos umbrales ayudan a detectar de forma temprana posibles problemas de saturaci贸n de memoria.</p>
<hr>
<h3 id="time-series-trafico-de-red-panel">Time series - Tr谩fico de Red Panel</h3>
<p>El siguiente paso es crear gr谩ficos de l铆nea para monitorear el tr谩fico de red en tiempo real.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-totalTraffic.png" data-desc-position="bottom"><img alt="Traffic-Graph" src="../../assets/JPRO02-totalTraffic.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Time series</strong></li>
</ul>
<p>Panel Options  Title</p>
<ul>
<li><strong>Total Traffic</strong></li>
</ul>
<p>Query (PromQL)</p>
<p></p><div class="language-promql highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">sum</span><span class="o">(</span><span class="kr">irate</span><span class="o">(</span><span class="nv">ifHCInOctets</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}[</span><span class="err">$__rate_interval</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="o">)</span>
</span></code></pre></div>
<strong>Legend</strong>
Total in<p></p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">sum</span><span class="o">(</span><span class="kr">irate</span><span class="o">(</span><span class="nv">ifHCOutOctets</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}[</span><span class="err">$__rate_interval</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="o">)</span>
</span></code></pre></div>
<p><strong>Legend</strong>
Total out</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Estas consultas calculan la tasa de tr谩fico de red entrante y saliente en bits por segundo para el dispositivo con IP
10.255.255.2. La funci贸n <code>irate()</code> estima la tasa instant谩nea basada en los 煤ltimos datos disponibles, y el resultado se multiplica por 8 para convertir bytes a bits.</p>
</div>
<p>Standard options
Unit -&gt; bytes (SI)</p>
<p><strong>Overrides</strong>
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/overrides-total.png" data-desc-position="bottom"><img alt="Traffic-Graph-Overrides" src="../../assets/overrides-total.png"></a></p>
<p>En el apartado de overrides, seleccionamos Fields with Name y escribimos Total Out, luego en Graph styles -&gt; Transform, seleccionamos Negative Y, y obtenemos el panel adjuntado arriba.</p>
<hr>
<p>Por ultimo, crearemos el dashboard que contiene el total de tr谩fico pero de cada interfaz del router JPRO02, tanto entrada como salida, para obtener algo mas detallado.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-fixedTraffic.png" data-desc-position="bottom"><img alt="Interfaces-Traffic" src="../../assets/JPRO02-fixedTraffic.png"></a></p>
<p>Tipo de Visualizaci贸n</p>
<ul>
<li><strong>Time series</strong></li>
</ul>
<p>Panel Options  Title</p>
<ul>
<li><strong>Total Traffic Per Interface</strong></li>
</ul>
<p>Query (PromQL)</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kr">irate</span><span class="o">(</span><span class="nv">ifHCInOctets</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}[</span><span class="s">2m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p><strong>Legend</strong>
Total in {{ifName}} </p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kr">irate</span><span class="o">(</span><span class="nv">ifHCOutOctets</span><span class="p">{</span><span class="nl">instance</span><span class="o">=</span><span class="p">"</span><span class="s">10.255.255.2</span><span class="p">"}[</span><span class="s">2m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span></code></pre></div>
<p><strong>Legend</strong>
Total out {{ifName}}</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Estas consultas calculan la tasa de tr谩fico de red entrante y saliente en bits por segundo (bps) para cada interfaz del dispositivo, utilizando una ventana de 2 minutos y multiplicando por 8 para convertir de bytes a bits.</p>
</div>
<p>Standard options
Unit -&gt; bytes (SI)</p>
<p><strong>Overrides</strong></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../assets/JPRO02-overrides-snmp.png" data-desc-position="bottom"><img alt="Interfaces-Traffic-Overrides" src="../../assets/JPRO02-overrides-snmp.png"></a></p>
<p>En el apartado de overrides, seleccionamos Fields with Name y escribimos /.Out*/, luego en Graph styles -&gt; Transform, seleccionamos Negative Y, y obtenemos el panel adjuntado arriba.</p>
<hr>
<h2 id="conclusion">Conclusi贸n</h2>
<p>隆Y con esto hemos finalizado la configuraci贸n del stack de Grafana y Prometheus para monitorear nuestros dispositivos de red a trav茅s de SNMP! Ahora podemos visualizar m茅tricas detalladas y en tiempo real sobre el rendimiento y estado de nuestros equipos directamente desde los dashboards personalizados en Grafana. Tambi茅n obtendremos el mismo resultado haciendo con el resto de dispositivos de red.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 漏 2025 - 2026 Juan Si茅cola
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/juan-siecola" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
    </a>
  
    
    
    
    
    <a href="mailto:juanesiecola@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.path", "content.code.select", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>