{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u00a1Bienvenido a Juane\u2019s Home Lab! \ud83d\udc4b","text":""},{"location":"#bienvenido-a-juanes-home-lab","title":"\u00a1Bienvenido a Juane\u2019s Home Lab!","text":"<p>\u00a1Hola! Este sitio es mi documentaci\u00f3n t\u00e9cnica y laboratorio h\u00edbrido. Aqu\u00ed documento configuraciones, diagramas y pr\u00e1cticas reales de los conocimientos que voy adquiriendo a lo largo de mi formaci\u00f3n para poder aplicarlos y probarlos en distintos escenarios.</p> <p>El laboratorio fue desarrollado en GNS3, utilizando dispositivos de red como routers (Cisco y VyOS), switches (Cisco), firewall (PfSense) y servidores Debian 12. Adem\u00e1s se implementaron instancias de proveedores de Cloud como Amazon Web Services y Oracle Cloud Infraestructure, las cuales tienen conectividad mediante Tailscale (VPN de Cero configuraci\u00f3n) con mi topolog\u00eda local, con el prop\u00f3sito de dise\u00f1ar una arquitectura de red h\u00edbrida y desplegar servicios en ambos entornos.</p>"},{"location":"#que-encontraras-aqui","title":"Qu\u00e9 encontrar\u00e1s aqu\u00ed","text":"<ul> <li>Topolog\u00eda de red: Diagrama de la topolog\u00eda implementada con su correspondiente servicio en cada servidor.  </li> <li>Direcciones IP y VLANs: Planes de direccionamiento, tablas y rangos implementados IpV4.  </li> <li>Enrutamiento y protocolos: OSPF, NAT, VPN, DNS, rutas est\u00e1ticas, redistribuci\u00f3n entre routers y firewall.  </li> <li>Dispositivos individuales: Configuraciones de routers, switches, servidores y firewall.  </li> <li>Servicios desplegados con Docker: Despliegue de servicios utilizando la herramienta docker-compose en equipos de la topolog\u00eda y VMs en la nube.</li> </ul>"},{"location":"#navegacion-rapida","title":"Navegaci\u00f3n r\u00e1pida","text":"Secci\u00f3n Qu\u00e9 encontrar\u00e1s Topolog\u00eda Diagrama general y componentes de la red Subredes Planes de direccionamiento y subredes VLANs Configuraci\u00f3n de dominios de broadcast Routing Protocolos de enrutamiento y tablas Direcciones IP Direccionamiento IP por interfaz Dispositivos Configuraci\u00f3n de routers, switches y servidores Servicios Servicios desplegados con Docker en servers AWS Uso de la VM de AWS como proxy reverso para el ingreso a los servicios OCI Uso de la VM de Oracle Cloud para correr Grafana y Prometheus con Docker"},{"location":"#como-usar-este-sitio","title":"C\u00f3mo usar este sitio","text":"<ol> <li>Explora las secciones desde la barra lateral o los enlaces de arriba.  </li> <li>Cada secci\u00f3n incluye informaci\u00f3n sobre lo implementado.  </li> <li>Se incluyen im\u00e1genes, tablas y snippets de configuraci\u00f3n.  </li> </ol> <p>Warning</p> <p>Este sitio documenta un entorno de laboratorio en desarrollo activo.  Ten en cuenta que los enlaces a servicios en vivo (Grafana, Kuma, NetBox) dependen de un host f\u00edsico que no opera en r\u00e9gimen 24/7, por lo que es probable que los encuentres inactivos fuera de horario de pruebas.</p>"},{"location":"AWS/aws/","title":"AWS Reverse Proxy con NPM","text":""},{"location":"AWS/aws/#aws-reverse-proxy-con-npm","title":"AWS Reverse Proxy con NPM","text":"<p>Punto de Entrada P\u00fablico: <code>https://netbox.js-lab-uy.duckdns.org</code>, <code>https://kuma.js-lab-uy.duckdns.org</code>, <code>https://grafana.js-lab-uy.duckdns.org</code></p> <p>Este componente centraliza el punto de entrada p\u00fablico a todos los servicios internos del laboratorio en GNS3 y adem\u00e1s de dejar p\u00fablico el servicio de Grafana que corre en la nube de oracle. Utiliza una M\u00e1quina Virtual (VM) en AWS y Nginx Proxy Manager (NPM) para una gesti\u00f3n gr\u00e1fica y eficiente del tr\u00e1fico, SSL y Reverse Proxy.</p>"},{"location":"AWS/aws/#1-diseno-de-la-arquitectura","title":"1. Dise\u00f1o de la Arquitectura","text":"<p>El dise\u00f1o aprovecha la gesti\u00f3n centralizada de NPM y mantiene la seguridad del t\u00fanel VPN mediante Tailscale.</p> Componente Funci\u00f3n AWS EC2 VM Host del Proxy Reverso (peque\u00f1a y econ\u00f3mica). Docker / Docker Compose Entorno de ejecuci\u00f3n de NPM. Nginx Proxy Manager (NPM) Gesti\u00f3n gr\u00e1fica de SSL (Let's Encrypt) y Reverse Proxy. Tailscale Crea un t\u00fanel VPN cifrado entre AWS y el laboratorio local en GNS3. DNS P\u00fablico DuckDNS apunta <code>*.js-lab-uy.duckdns.org</code> a la IP p\u00fablica de AWS."},{"location":"AWS/aws/#2-flujo-de-trafico-publico-a-interno","title":"2. Flujo de Tr\u00e1fico (P\u00fablico a Interno)","text":"<p>El tr\u00e1fico p\u00fablico ingresa por AWS y viaja de forma segura hacia el laboratorio gracias a Tailscale.</p> <ol> <li>El usuario accede a <code>https://netbox.js-lab-uy.duckdns.org</code>.</li> <li>DuckDNS resuelve a la IP p\u00fablica de la VM AWS.</li> <li>La VM recibe la petici\u00f3n en el puerto 443.</li> <li>Nginx Proxy Manager termina SSL y aplica las reglas del Reverse Proxy.</li> <li>NPM reenv\u00eda la petici\u00f3n al servicio interno (<code>172.16.200.50:8000</code>).</li> <li>Tailscale transporta el tr\u00e1fico de manera cifrada hacia pfSense.</li> <li>pfSense reenv\u00eda el paquete hacia el servicio destino dentro de la red interna.</li> </ol> <p>Vista de la interfaz de Nginx Proxy Manager (NPM) que muestra el certificado wildcard .js-lab-uy.duckdns.org. Este certificado fue emitido autom\u00e1ticamente por Let's Encrypt usando el DDNS (DuckDNS) y es utilizado por todos los Proxy Hosts (NetBox, Kuma, Homer), centralizando la seguridad SSL y la renovaci\u00f3n autom\u00e1tica:*</p> <p></p> <p>Aqu\u00ed se puede ver la configuraci\u00f3n de proxy host para el servicio de NetBox:</p> <p></p> <p>Aqu\u00ed se puede ver la configuraci\u00f3n de proxy host para el servicio de Grafana: </p> <p>Aqu\u00ed se pueden ver todos los proxy hosts activos actualmente:</p> <p></p>"},{"location":"AWS/aws/#3-el-enlace-tailscale-enrutamiento-de-subred","title":"3. El Enlace: Tailscale (Enrutamiento de Subred)","text":"<p>El componente clave es Tailscale.</p> <ul> <li>El pfSense en el laboratorio est\u00e1 configurado para \"anunciar\" (advertise) las subredes internas (ej. <code>172.16.5.0/24</code> y <code>172.16.200.0/24</code>) a la Tailnet.</li> </ul> <p></p> <ul> <li>La VM de AWS est\u00e1 configurada para \"aceptar\" esas rutas. <pre><code>  sudo tailscale set --accept-routes\n</code></pre></li> </ul>"},{"location":"AWS/aws/#31-maquinas-de-la-tailnet","title":"3.1 M\u00e1quinas de la tailnet","text":""},{"location":"AWS/aws/#32-subnet-routes-que-comparte-pfsense","title":"3.2 Subnet Routes (que comparte PfSense)","text":"<p>Esto significa que la VM de AWS sabe c\u00f3mo llegar a <code>172.16.5.100</code> como si estuviera en su misma red local.</p>"},{"location":"AWS/aws/#4-instalacion-y-despliegue-de-npm","title":"4. Instalaci\u00f3n y Despliegue de NPM","text":"<p>NPM se implementa mediante un contenedor con Docker Compose, y accedemos a el con la IP que proporciona Tailscale a la vm por el puerto 81, para que no quede publico y solo los dispositivos que tienen acceso al t\u00fanel Tailscale (Tailnet), puedan alcanzar esa IP.</p> docker-compose.yml<pre><code>services:\n  app:\n    image: 'jc21/nginx-proxy-manager:latest'\n    restart: unless-stopped\n    ports:\n      # These ports are in format &lt;host-port&gt;:&lt;container-port&gt;\n      - '80:80' # Public HTTP Port\n      - '443:443' # Public HTTPS Port\n      - '81:81' # Admin Web Port\n    volumes:\n      - ./data:/data\n      - ./letsencrypt:/etc/letsencrypt\n</code></pre>"},{"location":"OCI/oci/","title":"Monitoreo con Grafana y Prometheus","text":""},{"location":"OCI/oci/#monitoreo-con-grafana-y-prometheus","title":"Monitoreo con Grafana y Prometheus","text":""},{"location":"OCI/oci/#1-resumen-de-conectividad","title":"1. Resumen de Conectividad","text":"<p>El sistema de observabilidad opera en un modelo h\u00edbrido, en el cu\u00e1l se ejecuta una instancia en Oracle Cloud, mientras que los dispositivos objetivos (Switches/Routers/Firewalls) se encuentran en una red local (GNS3).</p> <p>La comunicaci\u00f3n entre la nube y el sitio local se asegura mediante Tailscale (VPN).</p>"},{"location":"OCI/oci/#2-habilitar-snmp-en-dispositivos-de-red","title":"2. Habilitar SNMP en dispositivos de red","text":"<p>Para habilitar el protocolo SNMP es los dispositivos ubicados en GNS3 se necesitan ejecutar ciertos comandos que se detallan debajo:</p> CiscoVyOS <pre><code>configure terminal\nsnmp-server community public RO\nsnmp-server location \"Topologia red interna\"\nexit\nwrite memory\n</code></pre> <pre><code>configure\nset service snmp community public authorization ro\nset service snmp listen-address 10.255.255.1\ncommit\nsave\nexit\n</code></pre> <p>En caso de pfSense se puede hacer desde la webUI:</p> <p></p>"},{"location":"OCI/oci/#3-conectividad-segura-tailscale","title":"3. Conectividad Segura (Tailscale)","text":"<p>Para alcanzar los objetivos SNMP que tienen IPs privadas, la VM de Oracle utiliza la red Tailnet, ya que El firewall PfSense es quien comparte las redes, y la vm de Oracle acepta estas rutas para alcanzar estas redes. De esta manera tengo conectividad con los dispositivos de mi topolog\u00eda en GNS3.</p> <p></p>"},{"location":"OCI/oci/#31-flujo-de-datos-snmp","title":"3.1 Flujo de Datos SNMP","text":"<ol> <li> <p>Origen:    Prometheus inicia el scrape SNMP desde la VM en Oracle Cloud hacia un dispositivo de la red interna (por ejemplo <code>192.168.1.1</code>).</p> </li> <li> <p>Enrutamiento:    La tabla de rutas del sistema operativo identifica que la red destino (<code>192.168.1.0/24</code>) est\u00e1 anunciada por Tailscale, por lo que el tr\u00e1fico se env\u00eda a trav\u00e9s de la interfaz <code>tailscale0</code>.</p> </li> <li> <p>Transporte:    Los paquetes SNMP se encapsulan y cifran mediante Tailscale (WireGuard) y viajan por internet hasta el Subnet Router, que en este caso es el pfSense en GNS3, encargado de anunciar las rutas de la LAN.</p> </li> <li> <p>Destino:    El pfSense recibe el tr\u00e1fico desde Tailscale y lo enruta hacia el dispositivo de red correspondiente dentro de su red LAN, completando la solicitud SNMP.</p> </li> </ol> <p>Info</p> <p>Gracias a esta arquitectura, no es necesario abrir el puerto UDP 161 en el firewall.</p>"},{"location":"OCI/oci/#4-reglas-de-firewall-security-lists-oci","title":"4. Reglas de Firewall (Security Lists OCI)","text":"<p>En las reglas de seguridad de la VCN, no es necesario abrir los puertos 3000 (Grafana), 9090 (Prometheus) ni (9116) como reglas de entrada. En cambio, para dejar p\u00fablico el servicio de Grafana en internet, como reglas de entrada se abren los puertos  80 y 443.</p> <p></p>"},{"location":"OCI/oci/#41-acceso-a-los-servicios","title":"4.1 Acceso a los Servicios","text":"<p>Para acceder al dashboard de grafana se utiliza la URL <code>https://grafana.js-lab-uy.duckdns.org</code>, pero para acceder a prometheus y snmp_exporter se necesita la direcci\u00f3n asignada a la VM por tailscale, indicando el puerto del contenedor correspondiente.</p> <p>Requisito: El dispositivo desde donde se accede debe tener el cliente Tailscale conectado y estar dentro de la misma Tailnet.</p> Servicio URL de Acceso Grafana <code>https://grafana.js-lab-uy.duckdns.org</code> Prometheus <code>http://100.103.72.38:9090</code> SNMP Exporter <code>http://100.103.72.38:9116</code> <p></p> <p></p> <p></p> <p>En el apartado de servicios -&gt; grafana est\u00e1 todo m\u00e1s detallada su configuraci\u00f3n, o haciendo click en el enlace Grafana</p>"},{"location":"dispositivos/","title":"Inventario de Dispositivos","text":""},{"location":"dispositivos/#inventario-de-dispositivos","title":"Inventario de Dispositivos","text":"<p>Aqu\u00ed se encuentra la documentaci\u00f3n detallada de la configuraci\u00f3n para cada dispositivo de la red.</p>"},{"location":"dispositivos/#routers-y-firewall","title":"Routers y Firewall","text":"<ul> <li>JPROO2 (Cisco)</li> <li>JPROO1 (VyOS)</li> <li>JPFW01 (pfSense)</li> </ul>"},{"location":"dispositivos/#switches","title":"Switches","text":"<ul> <li>JPSWC01 (Core)</li> <li>JPSWA01 (Acceso)</li> </ul>"},{"location":"dispositivos/#servidores","title":"Servidores","text":"<ul> <li>JDATSR01</li> <li>JDCSR01</li> <li>JDEVSR01</li> <li>JJUMSR01</li> </ul>"},{"location":"dispositivos/firewall/jpfw01/","title":"Configuraci\u00f3n: JPFW01 (PfSense)","text":""},{"location":"dispositivos/firewall/jpfw01/#configuracion-jpfw01-pfsense","title":"Configuraci\u00f3n: JPFW01 (PfSense)","text":"<p>Este es el firewall de borde y el gateway a Internet de la red. Se encarga de la seguridad y del NAT (Traducci\u00f3n de Direcciones de Red).</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;pfsense&gt;\n    &lt;version&gt;23.3&lt;/version&gt;\n    &lt;lastchange/&gt;\n    &lt;system&gt;\n        &lt;optimization&gt;normal&lt;/optimization&gt;\n        &lt;hostname&gt;JPFW01&lt;/hostname&gt;\n        &lt;domain&gt;home.arpa&lt;/domain&gt;\n        &lt;group&gt;\n            &lt;name&gt;all&lt;/name&gt;\n            &lt;description&gt;All Users&lt;/description&gt;\n            &lt;scope&gt;system&lt;/scope&gt;\n            &lt;gid&gt;1998&lt;/gid&gt;\n            &lt;member&gt;0&lt;/member&gt;\n        &lt;/group&gt;\n        &lt;group&gt;\n            &lt;name&gt;admins&lt;/name&gt;\n            &lt;description&gt;System Administrators&lt;/description&gt;\n            &lt;scope&gt;system&lt;/scope&gt;\n            &lt;gid&gt;1999&lt;/gid&gt;\n            &lt;member&gt;0&lt;/member&gt;\n            &lt;priv&gt;page-all&lt;/priv&gt;\n        &lt;/group&gt;\n        &lt;user&gt;\n            &lt;name&gt;admin&lt;/name&gt;\n            &lt;descr&gt;System Administrator&lt;/descr&gt;\n            &lt;scope&gt;system&lt;/scope&gt;\n            &lt;groupname&gt;admins&lt;/groupname&gt;\n            &lt;uid&gt;0&lt;/uid&gt;\n            &lt;priv&gt;user-shell-access&lt;/priv&gt;\n            &lt;bcrypt-hash&gt;\n$2y$10$8Ue6lNuNDjnmbS7vKiwXeO64Trs4cblZpb1oZR81f.xVhYEY3Uoqm\n            &lt;/bcrypt-hash&gt;\n        &lt;/user&gt;\n        &lt;nextuid&gt;2000&lt;/nextuid&gt;\n        &lt;nextgid&gt;2000&lt;/nextgid&gt;\n        &lt;timeservers&gt;2.pfsense.pool.ntp.org&lt;/timeservers&gt;\n        &lt;webgui&gt;\n            &lt;protocol&gt;http&lt;/protocol&gt;\n            &lt;loginautocomplete/&gt;\n            &lt;ssl-certref&gt;68b4b9b15bd98&lt;/ssl-certref&gt;\n            &lt;althostnames/&gt;\n            &lt;dashboardcolumns&gt;2&lt;/dashboardcolumns&gt;\n            &lt;webguicss&gt;pfSense.css&lt;/webguicss&gt;\n            &lt;logincss&gt;1e3f75;&lt;/logincss&gt;\n        &lt;/webgui&gt;\n        &lt;disablenatreflection&gt;yes&lt;/disablenatreflection&gt;\n        &lt;disablesegmentationoffloading/&gt;\n        &lt;disablelargereceiveoffloading/&gt;\n        &lt;ipv6allow/&gt;\n        &lt;maximumtableentries&gt;400000&lt;/maximumtableentries&gt;\n        &lt;powerd_ac_mode&gt;hadp&lt;/powerd_ac_mode&gt;\n        &lt;powerd_battery_mode&gt;hadp&lt;/powerd_battery_mode&gt;\n        &lt;powerd_normal_mode&gt;hadp&lt;/powerd_normal_mode&gt;\n        &lt;bogons&gt;\n            &lt;interval&gt;monthly&lt;/interval&gt;\n        &lt;/bogons&gt;\n        &lt;hn_altq_enable/&gt;\n        &lt;already_run_config_upgrade/&gt;\n        &lt;ssh&gt;\n            &lt;enable&gt;enabled&lt;/enable&gt;\n        &lt;/ssh&gt;\n        &lt;timezone&gt;America/Montevideo&lt;/timezone&gt;\n        &lt;language&gt;en_US&lt;/language&gt;\n        &lt;dnsserver&gt;8.8.8.8&lt;/dnsserver&gt;\n        &lt;dnsserver&gt;1.1.1.1&lt;/dnsserver&gt;\n        &lt;dnsallowoverride/&gt;\n        &lt;dns1gw&gt;none&lt;/dns1gw&gt;\n        &lt;dns2gw&gt;none&lt;/dns2gw&gt;\n    &lt;/system&gt;\n    &lt;interfaces&gt;\n        &lt;wan&gt;\n            &lt;enable/&gt;\n            &lt;if&gt;em0&lt;/if&gt;\n            &lt;blockpriv/&gt;\n            &lt;blockbogons/&gt;\n            &lt;descr&gt;WAN&lt;/descr&gt;\n            &lt;ipaddr&gt;dhcp&lt;/ipaddr&gt;\n            &lt;dhcphostname/&gt;\n            &lt;alias-address/&gt;\n            &lt;alias-subnet&gt;32&lt;/alias-subnet&gt;\n            &lt;dhcprejectfrom/&gt;\n            &lt;adv_dhcp_pt_timeout/&gt;\n            &lt;adv_dhcp_pt_retry/&gt;\n            &lt;adv_dhcp_pt_select_timeout/&gt;\n            &lt;adv_dhcp_pt_reboot/&gt;\n            &lt;adv_dhcp_pt_backoff_cutoff/&gt;\n            &lt;adv_dhcp_pt_initial_interval/&gt;\n            &lt;adv_dhcp_pt_values&gt;SavedCfg&lt;/adv_dhcp_pt_values&gt;\n            &lt;adv_dhcp_send_options/&gt;\n            &lt;adv_dhcp_request_options/&gt;\n            &lt;adv_dhcp_required_options/&gt;\n            &lt;adv_dhcp_option_modifiers/&gt;\n            &lt;adv_dhcp_config_advanced/&gt;\n            &lt;adv_dhcp_config_file_override/&gt;\n            &lt;adv_dhcp_config_file_override_path/&gt;\n            &lt;ipaddrv6&gt;dhcp6&lt;/ipaddrv6&gt;\n            &lt;dhcp6-duid/&gt;\n            &lt;dhcp6-ia-pd-len&gt;0&lt;/dhcp6-ia-pd-len&gt;\n            &lt;adv_dhcp6_prefix_selected_interface&gt;wan&lt;/adv_dhcp6_prefix_selected_interface&gt;\n            &lt;spoofmac/&gt;\n        &lt;/wan&gt;\n        &lt;lan&gt;\n            &lt;enable/&gt;\n            &lt;if&gt;em1&lt;/if&gt;\n            &lt;ipaddr&gt;192.168.1.1&lt;/ipaddr&gt;\n            &lt;subnet&gt;24&lt;/subnet&gt;\n            &lt;ipaddrv6/&gt;\n            &lt;subnetv6/&gt;\n            &lt;media/&gt;\n            &lt;mediaopt/&gt;\n            &lt;track6-interface&gt;wan&lt;/track6-interface&gt;\n            &lt;track6-prefix-id&gt;0&lt;/track6-prefix-id&gt;\n            &lt;gateway/&gt;\n            &lt;gatewayv6/&gt;\n        &lt;/lan&gt;\n        &lt;opt1&gt;\n            &lt;descr&gt;REDINTERNA&lt;/descr&gt;\n            &lt;if&gt;em2&lt;/if&gt;\n            &lt;spoofmac/&gt;\n            &lt;enable/&gt;\n            &lt;ipaddr&gt;10.10.0.1&lt;/ipaddr&gt;\n            &lt;subnet&gt;30&lt;/subnet&gt;\n        &lt;/opt1&gt;\n    &lt;/interfaces&gt;\n    &lt;staticroutes&gt;\n        &lt;route&gt;\n            &lt;network&gt;172.16.5.0/24&lt;/network&gt;\n            &lt;gateway&gt;HACIA_RED_INTERNA&lt;/gateway&gt;\n            &lt;descr&gt;HACIA RED VLAN 5&lt;/descr&gt;\n        &lt;/route&gt;\n        &lt;route&gt;\n            &lt;network&gt;172.16.10.0/24&lt;/network&gt;\n            &lt;gateway&gt;HACIA_RED_INTERNA&lt;/gateway&gt;\n            &lt;descr&gt;HACIA RED VLAN 10&lt;/descr&gt;\n        &lt;/route&gt;\n        &lt;route&gt;\n            &lt;network&gt;172.16.200.0/24&lt;/network&gt;\n            &lt;gateway&gt;HACIA_RED_INTERNA&lt;/gateway&gt;\n            &lt;descr&gt;HACIA RED VLAN 200&lt;/descr&gt;\n        &lt;/route&gt;\n    &lt;/staticroutes&gt;\n    &lt;dhcpd&gt;\n        &lt;lan&gt;\n            &lt;range&gt;\n                &lt;from&gt;192.168.1.10&lt;/from&gt;\n                &lt;to&gt;192.168.1.245&lt;/to&gt;\n            &lt;/range&gt;\n        &lt;/lan&gt;\n    &lt;/dhcpd&gt;\n    &lt;dhcpdv6&gt;\n        &lt;lan&gt;\n            &lt;range&gt;\n                &lt;from&gt;::1000&lt;/from&gt;\n                &lt;to&gt;::2000&lt;/to&gt;\n            &lt;/range&gt;\n            &lt;ramode&gt;disabled&lt;/ramode&gt;\n            &lt;rapriority&gt;medium&lt;/rapriority&gt;\n        &lt;/lan&gt;\n    &lt;/dhcpdv6&gt;\n    &lt;snmpd&gt;\n        &lt;syslocation/&gt;\n        &lt;syscontact/&gt;\n        &lt;rocommunity&gt;public&lt;/rocommunity&gt;\n    &lt;/snmpd&gt;\n    &lt;diag&gt;\n        &lt;ipv6nat&gt;\n            &lt;ipaddr/&gt;\n        &lt;/ipv6nat&gt;\n    &lt;/diag&gt;\n    &lt;syslog&gt;\n        &lt;filterdescriptions&gt;1&lt;/filterdescriptions&gt;\n    &lt;/syslog&gt;\n    &lt;nat&gt;\n        &lt;outbound&gt;\n            &lt;mode&gt;hybrid&lt;/mode&gt;\n            &lt;rule&gt;\n                &lt;source&gt;\n                    &lt;network&gt;10.10.0.0/30&lt;/network&gt;\n                &lt;/source&gt;\n                &lt;sourceport/&gt;\n                &lt;descr/&gt;\n                &lt;target&gt;wanip&lt;/target&gt;\n                &lt;target_subnet/&gt;\n                &lt;interface&gt;wan&lt;/interface&gt;\n                &lt;poolopts/&gt;\n                &lt;source_hash_key/&gt;\n                &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n                &lt;destination&gt;\n                    &lt;any/&gt;\n                &lt;/destination&gt;\n                &lt;created&gt;\n                    &lt;time&gt;1756750749&lt;/time&gt;\n                    &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n                &lt;/created&gt;\n                &lt;updated&gt;\n                    &lt;time&gt;1756750795&lt;/time&gt;\n                    &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n                &lt;/updated&gt;\n            &lt;/rule&gt;\n        &lt;/outbound&gt;\n        &lt;separator/&gt;\n    &lt;/nat&gt;\n    &lt;filter&gt;\n        &lt;rule&gt;\n            &lt;id/&gt;\n            &lt;tracker&gt;1762624009&lt;/tracker&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;interface&gt;wan&lt;/interface&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;tag/&gt;\n            &lt;tagged/&gt;\n            &lt;max/&gt;\n            &lt;max-src-nodes/&gt;\n            &lt;max-src-conn/&gt;\n            &lt;max-src-states/&gt;\n            &lt;statetimeout/&gt;\n            &lt;statetype&gt;keep state&lt;/statetype&gt;\n            &lt;os/&gt;\n            &lt;protocol&gt;udp&lt;/protocol&gt;\n            &lt;source&gt;\n                &lt;any/&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;network&gt;wanip&lt;/network&gt;\n                &lt;port&gt;41641&lt;/port&gt;\n            &lt;/destination&gt;\n            &lt;descr&gt;Permitir Tailscale&lt;/descr&gt;\n            &lt;created&gt;\n                &lt;time&gt;1762624009&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/created&gt;\n            &lt;updated&gt;\n                &lt;time&gt;1762624248&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/updated&gt;\n        &lt;/rule&gt;\n        &lt;rule&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;descr&gt;Default allow LAN to any rule&lt;/descr&gt;\n            &lt;interface&gt;lan&lt;/interface&gt;\n            &lt;tracker&gt;0100000101&lt;/tracker&gt;\n            &lt;source&gt;\n                &lt;network&gt;lan&lt;/network&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;any/&gt;\n            &lt;/destination&gt;\n        &lt;/rule&gt;\n        &lt;rule&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;ipprotocol&gt;inet6&lt;/ipprotocol&gt;\n            &lt;descr&gt;Default allow LAN IPv6 to any rule&lt;/descr&gt;\n            &lt;interface&gt;lan&lt;/interface&gt;\n            &lt;tracker&gt;0100000102&lt;/tracker&gt;\n            &lt;source&gt;\n                &lt;network&gt;lan&lt;/network&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;any/&gt;\n            &lt;/destination&gt;\n        &lt;/rule&gt;\n        &lt;rule&gt;\n            &lt;id/&gt;\n            &lt;tracker&gt;1762571690&lt;/tracker&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;interface&gt;Tailscale&lt;/interface&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;tag/&gt;\n            &lt;tagged/&gt;\n            &lt;max/&gt;\n            &lt;max-src-nodes/&gt;\n            &lt;max-src-conn/&gt;\n            &lt;max-src-states/&gt;\n            &lt;statetimeout/&gt;\n            &lt;statetype&gt;keep state&lt;/statetype&gt;\n            &lt;os/&gt;\n            &lt;protocol&gt;tcp&lt;/protocol&gt;\n            &lt;source&gt;\n                &lt;any/&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;any/&gt;\n            &lt;/destination&gt;\n            &lt;descr/&gt;\n            &lt;created&gt;\n                &lt;time&gt;1762571690&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/created&gt;\n            &lt;updated&gt;\n                &lt;time&gt;1762571806&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/updated&gt;\n        &lt;/rule&gt;\n        &lt;rule&gt;\n            &lt;id/&gt;\n            &lt;tracker&gt;1762619052&lt;/tracker&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;interface&gt;opt1&lt;/interface&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;tag/&gt;\n            &lt;tagged/&gt;\n            &lt;max/&gt;\n            &lt;max-src-nodes/&gt;\n            &lt;max-src-conn/&gt;\n            &lt;max-src-states/&gt;\n            &lt;statetimeout/&gt;\n            &lt;statetype&gt;keep state&lt;/statetype&gt;\n            &lt;os/&gt;\n            &lt;protocol&gt;tcp&lt;/protocol&gt;\n            &lt;source&gt;\n                &lt;any/&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;any/&gt;\n                &lt;port&gt;22&lt;/port&gt;\n            &lt;/destination&gt;\n            &lt;descr/&gt;\n            &lt;updated&gt;\n                &lt;time&gt;1762619052&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/updated&gt;\n            &lt;created&gt;\n                &lt;time&gt;1762619052&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/created&gt;\n        &lt;/rule&gt;\n        &lt;rule&gt;\n            &lt;id/&gt;\n            &lt;tracker&gt;1756749792&lt;/tracker&gt;\n            &lt;type&gt;pass&lt;/type&gt;\n            &lt;interface&gt;opt1&lt;/interface&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;tag/&gt;\n            &lt;tagged/&gt;\n            &lt;max/&gt;\n            &lt;max-src-nodes/&gt;\n            &lt;max-src-conn/&gt;\n            &lt;max-src-states/&gt;\n            &lt;statetimeout/&gt;\n            &lt;statetype&gt;keep state&lt;/statetype&gt;\n            &lt;os/&gt;\n            &lt;source&gt;\n                &lt;any/&gt;\n            &lt;/source&gt;\n            &lt;destination&gt;\n                &lt;any/&gt;\n            &lt;/destination&gt;\n            &lt;descr/&gt;\n            &lt;created&gt;\n                &lt;time&gt;1756749792&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/created&gt;\n            &lt;updated&gt;\n                &lt;time&gt;1756750298&lt;/time&gt;\n                &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n            &lt;/updated&gt;\n        &lt;/rule&gt;\n        &lt;separator&gt;\n            &lt;opt1/&gt;\n            &lt;wan/&gt;\n            &lt;tailscale/&gt;\n        &lt;/separator&gt;\n    &lt;/filter&gt;\n    &lt;shaper&gt; &lt;/shaper&gt;\n    &lt;ipsec&gt;\n        &lt;client/&gt;\n    &lt;/ipsec&gt;\n    &lt;aliases/&gt;\n    &lt;proxyarp/&gt;\n    &lt;cron&gt;\n        &lt;item&gt;\n            &lt;minute&gt;*/1&lt;/minute&gt;\n            &lt;hour&gt;*&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/sbin/newsyslog&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;1&lt;/minute&gt;\n            &lt;hour&gt;3&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/etc/rc.periodic daily&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;15&lt;/minute&gt;\n            &lt;hour&gt;4&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;6&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/etc/rc.periodic weekly&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;30&lt;/minute&gt;\n            &lt;hour&gt;5&lt;/hour&gt;\n            &lt;mday&gt;1&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/etc/rc.periodic monthly&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;1,31&lt;/minute&gt;\n            &lt;hour&gt;0-5&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/bin/nice -n20 adjkerntz -a&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;1&lt;/minute&gt;\n            &lt;hour&gt;3&lt;/hour&gt;\n            &lt;mday&gt;1&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/bin/nice -n20 /etc/rc.update_bogons.sh&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;1&lt;/minute&gt;\n            &lt;hour&gt;1&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/bin/nice -n20 /etc/rc.dyndns.update&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;*/60&lt;/minute&gt;\n            &lt;hour&gt;*&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;\n/usr/bin/nice -n20 /usr/local/sbin/expiretable -v -t 3600 virusprot\n            &lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;30&lt;/minute&gt;\n            &lt;hour&gt;12&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/bin/nice -n20 /etc/rc.update_urltables&lt;/command&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n            &lt;minute&gt;1&lt;/minute&gt;\n            &lt;hour&gt;0&lt;/hour&gt;\n            &lt;mday&gt;*&lt;/mday&gt;\n            &lt;month&gt;*&lt;/month&gt;\n            &lt;wday&gt;*&lt;/wday&gt;\n            &lt;who&gt;root&lt;/who&gt;\n            &lt;command&gt;/usr/bin/nice -n20 /etc/rc.update_pkg_metadata&lt;/command&gt;\n        &lt;/item&gt;\n    &lt;/cron&gt;\n    &lt;wol/&gt;\n    &lt;rrd&gt;\n        &lt;enable/&gt;\n    &lt;/rrd&gt;\n    &lt;widgets&gt;\n        &lt;sequence&gt;\nsystem_information:col1:show,disks:col1:show,netgate_services_and_support:col2:show,interfaces:col2:show\n        &lt;/sequence&gt;\n        &lt;period&gt;10&lt;/period&gt;\n    &lt;/widgets&gt;\n    &lt;openvpn/&gt;\n    &lt;dnshaper&gt; &lt;/dnshaper&gt;\n    &lt;unbound&gt;\n        &lt;enable/&gt;\n        &lt;dnssec/&gt;\n        &lt;active_interface/&gt;\n        &lt;outgoing_interface/&gt;\n        &lt;custom_options/&gt;\n        &lt;hideidentity/&gt;\n        &lt;hideversion/&gt;\n        &lt;dnssecstripped/&gt;\n    &lt;/unbound&gt;\n    &lt;vlans/&gt;\n    &lt;qinqs/&gt;\n    &lt;revision&gt;\n        &lt;time&gt;1762624248&lt;/time&gt;\n        &lt;description&gt;\nadmin@192.168.1.50 (Local Database): Firewall: Rules - saved/edited a firewall rule.\n        &lt;/description&gt;\n        &lt;username&gt;admin@192.168.1.50 (Local Database)&lt;/username&gt;\n    &lt;/revision&gt;\n    &lt;gateways&gt;\n        &lt;gateway_item&gt;\n            &lt;interface&gt;opt1&lt;/interface&gt;\n            &lt;gateway&gt;10.10.0.2&lt;/gateway&gt;\n            &lt;name&gt;HACIA_RED_INTERNA&lt;/name&gt;\n            &lt;weight&gt;1&lt;/weight&gt;\n            &lt;ipprotocol&gt;inet&lt;/ipprotocol&gt;\n            &lt;descr/&gt;\n            &lt;gw_down_kill_states/&gt;\n        &lt;/gateway_item&gt;\n        &lt;defaultgw4/&gt;\n        &lt;defaultgw6/&gt;\n    &lt;/gateways&gt;\n    &lt;captiveportal/&gt;\n    &lt;dnsmasq/&gt;\n    &lt;ntpd&gt;\n        &lt;gps/&gt;\n    &lt;/ntpd&gt;\n    &lt;cert&gt;\n        &lt;refid&gt;68b4b9b15bd98&lt;/refid&gt;\n        &lt;descr&gt;GUI default (68b4b9b15bd98)&lt;/descr&gt;\n        &lt;type&gt;server&lt;/type&gt;\n        &lt;crt&gt;\nLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUViekNDQTFlZ0F3SUJBZ0lJRS9BUkxST3hIZVF3RFFZSktvWklodmNOQVFFTEJRQXdWakUwTURJR0ExVUUKQ2hNcmNHWlRaVzV6WlNCSFZVa2daR1ZtWVhWc2RDQlRaV3htTFZOcFoyNWxaQ0JEWlhKMGFXWnBZMkYwWlRFZQpNQndHQTFVRUF4TVZjR1pUWlc1elpTMDJPR0kwWWpsaU1UVmlaRGs0TUI0WERUSTFNRGd6TVRJeE1EZ3dNVm9YCkRUSTJNVEF3TXpJeE1EZ3dNVm93VmpFME1ESUdBMVVFQ2hNcmNHWlRaVzV6WlNCSFZVa2daR1ZtWVhWc2RDQlQKWld4bUxWTnBaMjVsWkNCRFpYSjBhV1pwWTJGMFpURWVNQndHQTFVRUF4TVZjR1pUWlc1elpTMDJPR0kwWWpsaQpNVFZpWkRrNE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbE5UeENHaDYxV1pnCmswa3UzRk9kNzZDK1FOdllhMzNHeDlGWlM3UnNPSU1jSThreGFQUXlTWithVWRublFtb3JFOUovYmtMYzdmWnUKSEJ0eEcyWFJ2NGF2ZysyUk8xVkhnRjAvTjh2bk55QzdWbnVWSDNpb0FQUEtHcE1DZ0FEKzNhN0FvaUYzcjlKYgpwV0xycW5iRkxub0d2M25FYjN3cTR0S2xTcXowdmpQYld3V1Rad05YVVVVcy9SUEpwRWZuam1HOURQZU4vSGhpCmw3dE1sT3NNc3JESTQySHk5dCtvVmc1R3JJV1ZwSEttYmxIRE1jNDVkVmFnSS8yUGp1Nnd4RXFITEVqRjZrVlMKUFNrck1uRHY3bHdQOU92dS80cEJUZDNtdytrQWo1WUN1S2NKbkQ3K3diWUtISGpwai81MG4wOUtKWDhqM201NAo5bWFWcW03Q2Z3SURBUUFCbzRJQlB6Q0NBVHN3Q1FZRFZSMFRCQUl3QURBUkJnbGdoa2dCaHZoQ0FRRUVCQU1DCkJrQXdDd1lEVlIwUEJBUURBZ1dnTURNR0NXQ0dTQUdHK0VJQkRRUW1GaVJQY0dWdVUxTk1JRWRsYm1WeVlYUmwKWkNCVFpYSjJaWElnUTJWeWRHbG1hV05oZEdVd0hRWURWUjBPQkJZRUZFRlh3U3dNR1EzOHhYcEM3cndxK2x6bQprR2xPTUc4R0ExVWRJd1JvTUdhaFdxUllNRll4TkRBeUJnTlZCQW9USzNCbVUyVnVjMlVnUjFWSklHUmxabUYxCmJIUWdVMlZzWmkxVGFXZHVaV1FnUTJWeWRHbG1hV05oZEdVeEhqQWNCZ05WQkFNVEZYQm1VMlZ1YzJVdE5qaGkKTkdJNVlqRTFZbVE1T0lJSUUvQVJMUk94SGVRd0p3WURWUjBsQkNBd0hnWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRgpCd01DQmdnckJnRUZCUWdDQWpBZ0JnTlZIUkVFR1RBWGdoVndabE5sYm5ObExUWTRZalJpT1dJeE5XSmtPVGd3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFDelpkdmtjRGFzZk5hUndkNm96VElzeW5IOC9LOEV5cXZXUGdNbmoKZkNJb25XS0dMTG5MYTF0aDM5SnNYT29hTVVhemVQZnZmYXlBeCtDWnVSbVE1NFRQdUV0dCtsa1RQTytSUE4yVApUUnVuU2dKTE5qRkM5a0xzTjFkS3poRE84K2cvK29FcnljVHkwZzZBbUpiOTlmeXlpd1VOZEdadEowSmd4c0ZZCkwrSVIvMFk3QmE2cVJ3eFdWUGpORlJRMWhvYms5bnJSbk9Jd2hVWXBGODFacXl6ODR3c2ZmWGVzRWxxY05QcWgKV1NxQjZYTlBNRlUxdktVOW92ZXZnRytaNFRrc3NwaHpNeTNaamhvMStQUTRqTmZ4YXRmVFd3VHBrdjUrT0psVwpRbWs5N1ZTY3lTRmVDYkdXODRxQ3B2UnQyQ1ovRXVNbVpMcmwxQ0w1elY1aEpicz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n        &lt;/crt&gt;\n        &lt;prv&gt;\nLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQ1UxUEVJYUhyVlptQ1QKU1M3Y1U1M3ZvTDVBMjlocmZjYkgwVmxMdEd3NGd4d2p5VEZvOURKSm41cFIyZWRDYWlzVDBuOXVRdHp0OW00YwpHM0ViWmRHL2hxK0Q3WkU3VlVlQVhUODN5K2MzSUx0V2U1VWZlS2dBODhvYWt3S0FBUDdkcnNDaUlYZXYwbHVsCll1dXFkc1V1ZWdhL2VjUnZmQ3JpMHFWS3JQUytNOXRiQlpObkExZFJSU3o5RThta1IrZU9ZYjBNOTQzOGVHS1gKdTB5VTZ3eXlzTWpqWWZMMjM2aFdEa2FzaFpXa2NxWnVVY014empsMVZxQWovWStPN3JERVNvY3NTTVhxUlZJOQpLU3N5Y08vdVhBLzA2KzcvaWtGTjNlYkQ2UUNQbGdLNHB3bWNQdjdCdGdvY2VPbVAvblNmVDBvbGZ5UGVibmoyClpwV3Fic0ovQWdNQkFBRUNnZ0VBUkVBUVZsZy9OL3d1UG15WmdpMFFLSkxRbkVLVTBOcEpYVm1KOXZjQ2g3bk0KSGpjRm93a1V4SUZkemJvODNFNStlYVVXamRRNHB5RlNaaTVKWkpTQkpyRFhiUXIxQmozNXY0cERVczE5TnVFYQpON01OYy9TckttQ2hwaVVUU09ycjlYSE5ZYXd5VEIwTnJONmJqcnpQZUp3NTJ2VzJtSjlhdFZCK3Z5dG1RbzRuCkhkTkM0Z1E3bUJqb1lUNlMrY0d6MGV5dUN6czNPVllDSVhHeDEzVTArSUJoUTcyaXhFV09BS0VucXlBa3RoMDUKcEhRRWVONXlXTmNZbTRSbVlMU0JiQTNUenNnK0tLREFkWkxBMUZaa3RhR25mM1ZyeUVMalJRdFkyRXdIbExyegphSnpTY3g1UUZQcjZMZ3NXSVNySWRsRGYwQUdGS2ZkTEFlVXlkVWZadFFLQmdRREtXNVdrZkJZWmp2dFk3Q2c1CjBKRWQwdEM2MXBQZDJkUHAxVzFVSFRCaDlwTkFpK2U5bUhjazNpamVjd2FFSGN1bDc1WmV5d0pydUM3SXJtMTgKN0x4dmV2RmxhbGFyT1JmT0paMm9LbWlMWHdOeUV2dk9BYUdsZ2F0RGdENVM3d3dMd0kyRXMrbGo2ZXZ4N0czMAo4cXBGS25Pc0Uzd3hHdDdVT3pRM2E0Tkdld0tCZ1FDOFNQbTBOVkdsM1dmbitNRXNkY1pBaG83YnF5cXEvNW5pClNtbkhwaDl4QVc3YVgrbERnV080UWdud1cvSUJVV29jc0ViRExmd3NEczZJbXhiaTFVZlZyQXUzUlhnOFZ3Rm8KaGtVL0cyQW1qRE1xWlpxSEsyNnhRV093djFBWTYxN2JnNzZBbGNsL0tqeHNjdTc1NlNNRmxhOFdlSmU1aDljOQpHejdlcVVaV3pRS0JnQ3RFaSttZ3NxVUNZcEh2NU9YL3g1ZWw1UVdlTGYzSXZyd0g2NW1KcURlNkhtQTF5ZlpMCkxHYVFyaEpxYStGQjhiSm9XVEdwbkxubHB2TTRBS2N1ZzFnZTVKQzN2UkpkWWM2dFVsbUx2OURWSHdwOExxVXMKeWlCMmFtVkRmWkFFRndKSVNMb3dNZDR3UFVmOE1zS21SR3dIbUxZWmNIdWJjRHZXOE9KTXRjUVRBb0dBQW1ENQpwcWsxeXQ2dFBXVUxLOENoTEplR25vZmZGaUg4azd0VThzektnT2IvdTRxU3ErT3FtdDFhdXNxdW1BMnJSWW1FCm0xcXRZUEVlOHVMaXV5THVzV2huRFgyM015djJQSmZWc0NKc2FKQkU1VGc3WjVISTZEeG5RZ2hvdnFmYW52TmYKS01pN3J2WRuOUVqNjh4aVFPUFBQbjF2alV5R0Q2T1VlOE92dTlFQ2dZQm4rb0NSM0p2WjNNMDZjYnFFYWVvRApCRUtxRmpOV2lKWUpKVXA0OVk1dXRTZFV4TG1nV1lzeE02NG1zSVBwVlcwbFo5T256N29jRE9DWm9LUlVDbHBiClpzZGkyd0t3cDE3QitVbXlyS0lpc01keXF3KzJlRVRsZm0zNlRKZlpNS1dWT2ZkRS9obWJaVXY1SWZMaVdDSVMKaDlHcE4zNHUyYzFrR0F5TWRxTzQvUT09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K\n        &lt;/prv&gt;\n    &lt;/cert&gt;\n    &lt;ppps/&gt;\n    &lt;installedpackages&gt;\n        &lt;package&gt;\n            &lt;name&gt;Tailscale&lt;/name&gt;\n            &lt;descr&gt;\nTailscale is a mesh VPN alternative, based on WireGuard, that connects your computers, databases, and services together securely without any proxies.\n            &lt;/descr&gt;\n            &lt;pkginfolink&gt;https://github.com/tailscale/tailscale&lt;/pkginfolink&gt;\n            &lt;version&gt;0.1.4&lt;/version&gt;\n            &lt;configurationfile&gt;tailscale.xml&lt;/configurationfile&gt;\n            &lt;tabs&gt;\n                &lt;tab&gt;\n                    &lt;text&gt;Authentication&lt;/text&gt;\n                    &lt;url&gt;pkg_edit.php?xml=tailscale/tailscale_auth.xml&lt;/url&gt;\n                &lt;/tab&gt;\n                &lt;tab&gt;\n                    &lt;text&gt;Settings&lt;/text&gt;\n                    &lt;url&gt;pkg_edit.php?xml=tailscale.xml&lt;/url&gt;\n                    &lt;active/&gt;\n                &lt;/tab&gt;\n                &lt;tab&gt;\n                    &lt;text&gt;Status&lt;/text&gt;\n                    &lt;url&gt;status_tailscale.php&lt;/url&gt;\n                &lt;/tab&gt;\n            &lt;/tabs&gt;\n            &lt;include_file&gt;/usr/local/pkg/tailscale/tailscale.inc&lt;/include_file&gt;\n        &lt;/package&gt;\n        &lt;menu&gt;\n            &lt;name&gt;Tailscale&lt;/name&gt;\n            &lt;section&gt;VPN&lt;/section&gt;\n            &lt;configfile&gt;tailscale.xml&lt;/configfile&gt;\n            &lt;url&gt;/pkg_edit.php?xml=tailscale.xml&lt;/url&gt;\n        &lt;/menu&gt;\n        &lt;menu&gt;\n            &lt;name&gt;Tailscale &lt;/name&gt;\n            &lt;section&gt;Status&lt;/section&gt;\n            &lt;configfile&gt;tailscale.xml&lt;/configfile&gt;\n            &lt;url&gt;/status_tailscale.php&lt;/url&gt;\n        &lt;/menu&gt;\n        &lt;service&gt;\n            &lt;name&gt;tailscale&lt;/name&gt;\n            &lt;rcfile&gt;pfsense_tailscaled&lt;/rcfile&gt;\n            &lt;executable&gt;tailscaled&lt;/executable&gt;\n            &lt;description&gt;Tailscale Daemon&lt;/description&gt;\n        &lt;/service&gt;\n        &lt;tailscale&gt;\n            &lt;config&gt;\n                &lt;enable&gt;on&lt;/enable&gt;\n                &lt;listenport&gt;41641&lt;/listenport&gt;\n                &lt;statedir&gt;/usr/local/pkg/tailscale/state&lt;/statedir&gt;\n                &lt;keepconfig&gt;on&lt;/keepconfig&gt;\n                &lt;acceptdns&gt;on&lt;/acceptdns&gt;\n                &lt;exitnode/&gt;\n                &lt;acceptroutes/&gt;\n                &lt;row&gt;\n                    &lt;advertisedroutevalue/&gt;\n                    &lt;advertisedroutedescr/&gt;\n                &lt;/row&gt;\n                &lt;syslogenable/&gt;\n                &lt;syslogpriority&gt;notice&lt;/syslogpriority&gt;\n                &lt;syslogfacility&gt;daemon&lt;/syslogfacility&gt;\n            &lt;/config&gt;\n        &lt;/tailscale&gt;\n    &lt;/installedpackages&gt;\n    &lt;ifgroups&gt;\n        &lt;ifgroupentry&gt;\n            &lt;ifname&gt;Tailscale&lt;/ifname&gt;\n            &lt;descr&gt;Tailscale Interface Group (DO NOT EDIT/DELETE!)&lt;/descr&gt;\n            &lt;members/&gt;\n        &lt;/ifgroupentry&gt;\n    &lt;/ifgroups&gt;\n    &lt;sshdata&gt;\n        &lt;sshkeyfile&gt;\n            &lt;filename&gt;ssh_host_rsa_key&lt;/filename&gt;\n            &lt;xmldata&gt;\nldfHrqzKlgXQPl9x++gqEw9NvPeeHpD4xPv8+spzqqq3n/R2SEghBUgo1mCy4t9/v4PhRdn4x7R4w3WlfyxHDmiP/0fl4z+L/wIZwryzwfikLLQkUbe9Wp7+MxgRO7Le/zPls57aE5v+/8F8L1Y4/0xfnxyutnwAjPrv0vl9+M+NFU8TKqq9temp1LFFgwM+lvt+8notweum1Uptrd2+kStblFNXfAQ3thQYuF00DQcU82QUZT4XWnnDiyEnVM5szh5Y2AMDTO6rigTb/AofK2J2i9SsrM40XEZCOerc1wABB+ycWaZxhn2Ec8uP2XykRczuogmifT9jzPsY5elCrkN69uSLI8UhrYPhSg1DsosSIt4hd4KA4scSfJLQbnB1+6yxYOFMyLlFK77HKYof1bNBIIVu0Qr1BKM3L6ucm+zhN1lrM6DYvBvpPAdA5u9ioRK6kAYa6nP5kyUna54sKwrUMezRumDadZpe01GRBy+mv7hQ558ObWw4jU22IV14UQKTW+kz7urUNTxJu6pKY6kJRrxMRj6WUj0ezxkHzXun3fxdf1ySn9vJOC90NAQqv8iZ85rrmQAPi7qm8ZzXqpoPjSW9SX20VIg3h+La/TGGRCDNS9fmyOP98DRuJe37EimBzeJbsIpv4RwJxACB8ILpqW0pSTwftCxJw/g+jGtXtpJZG5Z/vr1xH/tsdvu1EHE02QnwIOG5T/ArEnWdsYuH7QBznKzfqg2HXlI0IYQH4sQRHuzha4TKKmofParar0vMEiI00jg/nEz3/SM5fakr5MHIkVlUVIDX9lHWwzL1rGS9ychCW2G+/Z53leA13KcMBW/9edus4YvbexXljynusz7X4enCrlBKDopPDPCH/stO7IcXib71hP4al3LEGLVI+cT/pWzgJ9q/lw38RPv3soGfaP9eNvAT7d/LBn6i/XvZwE+0fy8b+In272UDP9H+vWzgJ9q/lw38RPtvqHPfbP4b3jQjB7UQc9EFWoi5xIo4lLwKTzwMuSO2Z4I5hsDWpC/SeNKiwJTJbqD5U7aJz24gknVWD2br915+5ugorBxdggFrDNYUeWHktW/+ZsMS8qSAdAAOaXyELbLrsdhq7DVnWHygSPB946nZdAwz7zrNW1F5nRZ2Ov0RG4RFP+iNhw+/Lc1SVTC+4oF3KyMKXHZSlOxgV9VKx3ygXXMbj9NSu5nUqFaO+2QTRJhKxHD4GxO8WeW2Q958ltsNBbn0ECBpRkciSZOD1yOxtslfUabUGu7YsGD9DGY/jYn1WOHGW7GVFJbVQbP1BnV5rwN6ojz/vaFpBzzfbieYNJm/vzUe4cVLrSu1lL1YXYIFPdCDqKwvW8/UPEd7GUM5vl1zAaeiSUqstwwvz/wSAVS+fbeGy+qjvt25uk3iljEK95ThvURdM6hA/jOSQ1o4EdKcEu40hn/dq0/4CbKBsxqv2hnVgMsPKJQtqtmOzZVrlzsYCGLhGoXAiXpxGz7d7bHNyeVvwis9HQZ9QtARkSkos8dHPzBYhQgawJLLmOKr1MogR0y3jsdxiQplbETBB7WqYAWIAaXK2xsTemkbHRKhcOmngoskG62q/zlW3dCBA7ctOlUGx4g2IwlYl1ZYgQariRKhtz0SyblyktAdkAmVBIOz4CuYS8yf2TovLob8ZlvipjwQlDeGEYZmqvky2fHxqf+39VDykT8OtjBhO0YEhMzk5bNdDRm91NK1sBAewmqSQgRMnPyaAfimFVcT/PyiHjn4zLVMLOT+gxloX/pvmrRhSAgUdjBPfSIFqFXl+R05vDIVNrsKVkrk79DJgNTzsFEhRg3PE8H0QYu9XrUEJZ51MUJFkGBIHqyY6r1Laku5DotlwGNln2lc7j1lg7UK0pQG7M6x27cbWNAH9piay5HpPLgP/ChTKaiRqrqYZlZp1cS6/CE77PfPQySh10HmLF+kAhfK8+5hwFsqPT0p2aPo/bhujrcY5ZT2+bVkDV48TNRC7Q0uvOsxmqTGXG4wTZLPG2iEkiUL4hY3y7oCyIlXj4vVGGwpdmD1p9VjaGut2qzWhgkSt+hbjGvs5+N517Iw0LJwlUSkBi8+0Wa049CIoR3Ar7dPsL95O45GBCy+3WQfRK7mb+IhQwcSG1DX3vH5LLJza2Ai7Jswj+skoB9m4Iqh7MynqN+AGOOW5Wz2lCl5O2EUl8IkBBGXOdY5ZBLe226RtiGWcWK203Fnv8xrr6O0cMX77HQpDcdN1wW0tYN2il3HILysHuNKKpS7vLwmC0OXcD2vlJvKsiMQrFljJP0Q12ai0nMDO6+zVK3M8GIvLWBBgzkQ8PPcNr9q8+ep3ydJpavK+NDU4zVNjibv33vrvuL3oWi+Qt4ORiAEbxhIksHm4LQSDLwOSWdr+UXIA9r93wYLwl6gqriQwRaGTvAhTNSHd49y1GDzBSU+9FZErT3tYLjWmeWgMQBp9Qj9QAK+1E/UBw00rthKQXjfnx2cnlvxrZm8pslztqe1uqRR6JarphLsiPQ2g0kh6wRWAnxcew7YTI2E/iOJXU3MNKdKn9DQCMJSOGvJyDY71lnTujdP3EY5PjwowljC5wKSFYQozb6pAowSeGHGS8vhk7YCUpxSTkO75+1/P3cNEfy5HGlK0FNCJkruG/FUpcDCku/BqugvlLYRB4oSGICcjE6ib4tgRr3wklkq/fYczwxR2AQtiGUmjOSNU94IEbsvdsL3tTIDuhGUn8nFKg1oXtSKhIHCtqYHl+av7s8G00HeU8eLZ1SfTyKd4/dUpLbExep8YGraljmG9kXg7+GHN7j/fDD6Hw==\n            &lt;/xmldata&gt;\n        &lt;/sshkeyfile&gt;\n        &lt;sshkeyfile&gt;\n            &lt;filename&gt;ssh_host_rsa_key.pub&lt;/filename&gt;\n            &lt;xmldata&gt;\nFcfJsmNQAIDhfT/F3atuJMbFrWrzMRMJYXeIOWaC8/R9+9989S9L9Xte4Jfwk3h1EJTIM7so/1cWfEH8URJ8eZnL7bH1fqeWnMwUU4UxrOCfSgFPYlM6BTsD5nruBo11N9YOjZLrU8OqRlg0b7tpSuCBWnRfBDj7sloFR8qsxKOfbQ0lGTEOUlMMZUyw5Oau75rufFCIKmBpRYQnQFyXxSYlHk52UG0TP9KlScUsW0M4t1qElXUPCo0rgvQgvB2+JjUq1IEgXiKNP7cw9mTqfSuLVEYRRbiaF4B3tNhsCPSYb8z6/WowObCKRyt5tVzZj0vMKjw2GR8+MDZHABQ0I72Qpay8G8yHbEUqz+Qo2Rtn7QWdFXQ9fl6wnM7PT/sBAu2ad/LlwYUOViu63UVFuFwHuXsLRAFGGnubwjmPOrpqxf2QJJG7bGBRUoVSamzlJhwP5pliTUo0zgg41h5MbnuVQV0STxKBc3BcC9x6Dr9qXSNNpyRN3GIdbjtjHplOJvc2JIhV6frIpy1wUIE9eXtx0SFbSko8jLXRHzzVKbxSsO1zdaLe38gZfe6cUGZ5XkfcVaM6ktNOXb8HoVszdbKNJjyodK469sPgCE5JP6tZvO+qyPKiNlbdgSot5w6ckJcQ4i+1KsaITi5NiIm5h6XlKF6VZO3XmByrk1eX4xbwvejnN6rOSJQPcTv4G1OWR8KPNt8h68jw2o5mI4hv+ju8FJbQhNED3Q1BJ314ifa4sSnIDOekpqKV6CH3As3UKv7399c8DOtfw1MjgvxTDV3+B84j/PUP\n            &lt;/xmldata&gt;\n        &lt;/sshkeyfile&gt;\n        &lt;sshkeyfile&gt;\n            &lt;filename&gt;ssh_host_ed25519_key&lt;/filename&gt;\n            &lt;xmldata&gt;\nnZBLb4JAFIX3/Ar2xpRHa2HhYgZGGFAeivLYOaCoBSRkwIFfb8ekSTfd9Fuc3OSenNx75vNvILKwJ/oB8nY7Wwy2+AAiJLoo5cu5QFRYkcabjobcZckXLW4IcKD1MZB6z0dEar3PQvAD5LJ5cKVTrpQ0i4Vw9KI987nJgO0IsZvqFNxKrTjbK3XhOr2eWEogmT3Os5huunMUb+2Q+52r0kSopK3EBAx+p/43VOBHG+tuMnBjPi6zYGjYosOzK60PlWz3YXc0mF6dTm6pKcldtRqMyvamSIZvMlnLk/P9Xn/KQk7St9B/v7DqKI1U9zJUvH5fJc5A1C3YVdA6TICt68tA4n2fJs4jDZdL4VUt8sy/a38C\n            &lt;/xmldata&gt;\n        &lt;/sshkeyfile&gt;\n    &lt;/sshdata&gt;\n&lt;/pfsense&gt;\n</code></pre>"},{"location":"dispositivos/routers/jpro01/","title":"Configuraci\u00f3n: JPROO1 (VyOS)","text":""},{"location":"dispositivos/routers/jpro01/#configuracion-jproo1-vyos","title":"Configuraci\u00f3n: JPROO1 (VyOS)","text":"<p>Este es el router de n\u00facleo que gestiona el enrutamiento entre el PfSense y el router cisco. </p><pre><code>  interfaces {\n     ethernet eth0 {\n         address 10.10.0.2/30\n         description \"hacia firewall PfSense\"\n         hw-id 0c:08:d8:d9:00:00\n     }\n     ethernet eth1 {\n         address 10.10.1.1/30\n         description \"Hacia router cisco\"\n         hw-id 0c:08:d8:d9:00:01\n     }\n     ethernet eth2 {\n         hw-id 0c:08:d8:d9:00:02\n     }\n     ethernet eth3 {\n         hw-id 0c:08:d8:d9:00:03\n     }\n     ethernet eth4 {\n         hw-id 0c:08:d8:d9:00:04\n     }\n     loopback lo {\n         address 10.255.255.1/32\n     }\n }\n nat {\n     source {\n         rule 5 {\n             outbound-interface {\n                 name eth0\n             }\n             source {\n                 address 172.16.5.0/24\n             }\n             translation {\n                 address masquerade\n             }\n         }\n         rule 200 {\n             outbound-interface {\n                 name eth0\n             }\n             source {\n                 address 172.16.200.0/24\n             }\n             translation {\n                 address masquerade\n             }\n         }\n     }\n }\n protocols {\n     ospf {\n         area 10 {\n             network 10.10.1.0/30\n             network 10.10.0.0/30\n             network 10.255.255.1/32\n         }\n     }\n     static {\n         route 0.0.0.0/0 {\n             next-hop 10.10.0.1 {\n             }\n         }\n         route 172.16.1.0/24 {\n             next-hop 10.10.1.2 {\n             }\n         }\n     }\n }\n service {\n     ntp {\n         allow-client {\n             address 127.0.0.0/8\n             address 169.254.0.0/16\n             address 10.0.0.0/8\n             address 172.16.0.0/12\n             address 192.168.0.0/16\n             address ::1/128\n             address fe80::/10\n             address fc00::/7\n         }\n         server time1.vyos.net {\n         }\n         server time2.vyos.net {\n         }\n         server time3.vyos.net {\n         }\n     }\n     snmp {\n         community public {\n             authorization ro\n         }\n         listen-address 10.255.255.1 {\n         }\n     }\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 100\n     }\n     console {\n         device ttyS0 {\n             speed 115200\n         }\n     }\n     host-name JPRO01\n     name-server 8.8.8.8\n     name-server 1.1.1.1\n     option {\n         reboot-on-upgrade-failure 5\n     }\n     syslog {\n         local {\n             facility all {\n                 level info\n             }\n             facility local7 {\n                 level debug\n             }\n         }\n     }\n }\n</code></pre><p></p>"},{"location":"dispositivos/routers/jpro02/","title":"Configuraci\u00f3n: JPROO2 (Cisco)","text":""},{"location":"dispositivos/routers/jpro02/#configuracion-jproo2-cisco","title":"Configuraci\u00f3n: JPROO2 (Cisco)","text":"<p>Este es el router principal que gestiona el enrutamiento Inter-VLAN (Router-on-a-Stick) y se conecta al core de la red.</p> <pre><code>Current configuration : 4616 bytes\n!\n! Last configuration change at 00:10:33 UTC Fri Jan 2 2026\n!\nversion 15.9\nservice timestamps debug datetime msec\nservice timestamps log datetime msec\nservice password-encryption\n!\nhostname JPRO02\n!\nno ip domain lookup\nip domain name juane.prod\nip cef\nno ipv6 cef\n!\n!\ninterface Loopback0\n ip address 10.255.255.2 255.255.255.255\n!\ninterface GigabitEthernet0/0\n description \"Hacia router vyos\"\n ip address 10.10.1.2 255.255.255.252\n duplex auto\n speed auto\n media-type rj45\n!\ninterface GigabitEthernet0/1\n no ip address\n shutdown\n duplex auto\n speed auto\n media-type rj45\n!\ninterface GigabitEthernet0/2\n no ip address\n shutdown\n duplex auto\n speed auto\n media-type rj45\n!\ninterface GigabitEthernet0/3\n no ip address\n duplex auto\n speed auto\n media-type rj45\n!\ninterface GigabitEthernet0/3.5\n description Gateway de Vlan 5\n encapsulation dot1Q 5\n ip address 172.16.5.1 255.255.255.0\n!\ninterface GigabitEthernet0/3.10\n description Gateway de Vlan 10\n encapsulation dot1Q 10\n ip address 172.16.10.1 255.255.255.0\n!\ninterface GigabitEthernet0/3.99\n description Gateway de Vlan 99 Administrativa\n encapsulation dot1Q 99\n ip address 172.16.99.1 255.255.255.0\n!\ninterface GigabitEthernet0/3.200\n description Gateway de Vlan 200\n encapsulation dot1Q 200\n ip address 172.16.200.1 255.255.255.0\n!\ninterface GigabitEthernet0/3.500\n description VLAN_NATIVA\n encapsulation dot1Q 500 native\n!\nrouter ospf 1\n network 10.10.1.0 0.0.0.3 area 10\n network 10.255.255.2 0.0.0.0 area 10\n network 172.16.5.0 0.0.0.255 area 10\n network 172.16.10.0 0.0.0.255 area 10\n network 172.16.99.0 0.0.0.255 area 10\n network 172.16.200.0 0.0.0.255 area 10\n!\nip forward-protocol nd\n!\n!\nno ip http server\nno ip http secure-server\nip route 0.0.0.0 0.0.0.0 10.10.1.1\n!\nip access-list standard ADMIN_ONLY\n permit 172.16.10.10\n!\nipv6 ioam timestamp\n!\nsnmp-server community public RO\nsnmp-server location \"GNS3 Lab - Network Core\"\nsnmp-server chassis-id\nsnmp-server enable traps snmp authentication linkdown linkup coldstart warmstart\n!\n!\ncontrol-plane\n!\nbanner exec ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner incoming ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner login ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\n!\nline con 0\n exec-timeout 0 0\n privilege level 15\n logging synchronous\nline aux 0\n exec-timeout 0 0\n privilege level 15\n logging synchronous\nline vty 0 4\n access-class ADMIN_ONLY in\n login local\n transport input ssh\n!\nno scheduler allocate\n!\nend\n</code></pre>"},{"location":"dispositivos/servidores/JDATSR01/","title":"Configuraci\u00f3n: JDATSR01 (Debian 12 Server)","text":""},{"location":"dispositivos/servidores/JDATSR01/#configuracion-jdatsr01-debian-12-server","title":"Configuraci\u00f3n: JDATSR01 (Debian 12 Server)","text":"<pre><code># Loopback\nauto lo\niface lo inet loopback\n\n# Red principal est\u00e1tica\nauto ens4\niface ens4 inet static\n    address 172.16.5.100\n    netmask 255.255.255.0\n    gateway 172.16.5.1\n    dns-nameservers 172.16.10.11 8.8.4.4\n</code></pre>"},{"location":"dispositivos/servidores/JDCSR01/","title":"Configuraci\u00f3n: JDCSR01 (Debian 12 Server)","text":""},{"location":"dispositivos/servidores/JDCSR01/#configuracion-jdcsr01-debian-12-server","title":"Configuraci\u00f3n: JDCSR01 (Debian 12 Server)","text":"<pre><code># DHCP config for ens4\n#auto ens4\n#iface ens4 inet dhcp\n\n# Static config for ens4\nauto ens4\niface ens4 inet static\n        address 172.16.10.11\n        netmask 255.255.255.0\n        gateway 172.16.10.1\n        dns-nameservers 8.8.8.8\n</code></pre>"},{"location":"dispositivos/servidores/JDCSR01/#archivo-etcresolvconf","title":"Archivo <code>/etc/resolv.conf</code>","text":"<pre><code># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)\n#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN\n# 127.0.0.53 is the systemd-resolved stub resolver.\n# run \"resolvectl status\" to see details about the actual nameservers.\n\nnameserver 127.0.0.1\n</code></pre>"},{"location":"dispositivos/servidores/JDEVSR01/","title":"Configuraci\u00f3n: JDEVSR01 (Debian 12 Server)","text":""},{"location":"dispositivos/servidores/JDEVSR01/#configuracion-jdevsr01-debian-12-server","title":"Configuraci\u00f3n: JDEVSR01 (Debian 12 Server)","text":"<pre><code># Loopback\nauto lo\niface lo inet loopback\n#\n# Red principal (DHCP)\n###auto ens4\n#iface ens4 inet dhcp\n# Configuraci\u00f3n est\u00e1tica anterior (comentada)\n auto ens4\n iface ens4 inet static\n     address 172.16.200.50\n     netmask 255.255.255.0\n     gateway 172.16.200.1\n     dns-nameservers 172.16.10.11 8.8.4.4\n</code></pre>"},{"location":"dispositivos/servidores/JJUMSR01/","title":"Configuraci\u00f3n: JJUMSR01 (Debian 12 Server)","text":""},{"location":"dispositivos/servidores/JJUMSR01/#configuracion-jjumsr01-debian-12-server","title":"Configuraci\u00f3n: JJUMSR01 (Debian 12 Server)","text":"<pre><code># Loopback\nauto lo\niface lo inet loopback\n\n# Red principal\nauto ens4\niface ens4 inet static\n    address 172.16.10.10\n    netmask 255.255.255.0\n    gateway 172.16.10.1\n    dns-nameservers 172.16.10.11 8.8.4.4\n</code></pre>"},{"location":"dispositivos/switches/jpswa01/","title":"Configuraci\u00f3n: JPSWA01 (Cisco Acceso)","text":""},{"location":"dispositivos/switches/jpswa01/#configuracion-jpswa01-cisco-acceso","title":"Configuraci\u00f3n: JPSWA01 (Cisco Acceso)","text":"<p>Este es el switch de acceso que conecta los dispositivos finales (servidores) a la red. Su principal responsabilidad es asignar cada puerto a su VLAN correspondiente (VLAN 5, 10, 200) y conectarse al switch core (<code>JPSWC01</code>) mediante un enlace troncal.</p> <pre><code>Current configuration : 4351 bytes\n!\n! Last configuration change at 00:20:35 UTC Fri Jan 2 2026\n!\nhostname JPSWA01\n!\nboot-start-marker\nboot-end-marker\n!\n!\nip domain-name juane.prod\nip cef\nno ipv6 cef\n!\n!\n!\nspanning-tree mode pvst\nspanning-tree extend system-id\n!\nvlan internal allocation policy ascending\n!\n!\ninterface GigabitEthernet0/0\n switchport access vlan 5\n switchport mode access\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/1\n switchport access vlan 5\n switchport mode access\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/0\n switchport access vlan 200\n switchport mode access\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/1\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/0\n switchport access vlan 10\n switchport mode access\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/1\n switchport access vlan 10\n switchport mode access\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/0\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/1\n switchport trunk encapsulation dot1q\n switchport trunk native vlan 500\n switchport mode trunk\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/3\n media-type rj45\n negotiation auto\n!\ninterface Vlan1\n no ip address\n!\ninterface Vlan99\n description \"Vlan administrativa\"\n ip address 172.16.99.20 255.255.255.0\n!\nip forward-protocol nd\n!\nno ip http server\nno ip http secure-server\n!\nip route 0.0.0.0 0.0.0.0 172.16.99.1\n!\nip access-list standard ADMIN_ONLY\n permit 172.16.10.10\n!\n!\n!\n!\nsnmp-server community public RO\nsnmp-server location \"switch de acceso red interna\"\n!\ncontrol-plane\n!\nbanner exec ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner incoming ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner login ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\n!\nline con 0\nline aux 0\nline vty 0 4\n access-class ADMIN_ONLY in\n login local\n transport input ssh\n!\n!\nend\n</code></pre>"},{"location":"dispositivos/switches/jpswc01/","title":"Configuraci\u00f3n: JPSWC01 (Cisco Core)","text":""},{"location":"dispositivos/switches/jpswc01/#configuracion-jpswc01-cisco-core","title":"Configuraci\u00f3n: JPSWC01 (Cisco Core)","text":"<p>Este switch act\u00faa como el n\u00facleo (core) de la red. Su \u00fanica funci\u00f3n es agregar los enlaces troncales (trunks) y conectar el switch de acceso (<code>JPSWA01</code>) con el router principal (<code>JPROO2</code>).</p> <pre><code>Current configuration : 4185 bytes\n!\n! Last configuration change at 00:45:49 UTC Fri Jan 2 2026\nhostname JPSWC01\n!\nboot-start-marker\nboot-end-marker\n!\n!\nip domain-name juane.prod\nip cef\nno ipv6 cef\n!\n!\n!\nspanning-tree mode pvst\nspanning-tree extend system-id\n!\nvlan internal allocation policy ascending\n!\n!\n!\ninterface GigabitEthernet0/0\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/1\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet0/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/0\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/1\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet1/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/0\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/1\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet2/3\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/0\n switchport trunk encapsulation dot1q\n switchport trunk native vlan 500\n switchport mode trunk\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/1\n switchport trunk encapsulation dot1q\n switchport trunk native vlan 500\n switchport mode trunk\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/2\n media-type rj45\n negotiation auto\n!\ninterface GigabitEthernet3/3\n media-type rj45\n negotiation auto\n!\ninterface Vlan1\n no ip address\n!\ninterface Vlan99\n description \"Vlan administrativa\"\n ip address 172.16.99.10 255.255.255.0\n!\nip forward-protocol nd\n!\nno ip http server\nno ip http secure-server\n!\nip route 0.0.0.0 0.0.0.0 172.16.99.1\n!\nip access-list standard ADMIN_ONLY\n permit 172.16.10.10\n!\n!\n!\n!\nsnmp-server community public RO\nsnmp-server location \"Topologia red interna\"\n!\ncontrol-plane\n!\nbanner exec ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner incoming ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\nbanner login ^C\n**************************************************************************\n* IOSv is strictly limited to use for evaluation, demonstration and IOS  *\n* education. IOSv is provided as-is and is not supported by Cisco's      *\n* Technical Advisory Center. Any use or disclosure, in whole or in part, *\n* of the IOSv Software or Documentation to any third party for any       *\n* purposes is expressly prohibited except as otherwise authorized by     *\n* Cisco in writing.                                                      *\n**************************************************************************^C\n!\nline con 0\nline aux 0\nline vty 0 4\n access-class ADMIN_ONLY in\n login local\n transport input ssh\n!\n!\nend\n</code></pre>"},{"location":"servicios/","title":"Servicios de Gesti\u00f3n y Monitoreo","text":""},{"location":"servicios/#servicios-de-gestion-y-monitoreo","title":"Servicios de Gesti\u00f3n y Monitoreo","text":"<p>Esta secci\u00f3n documenta las herramientas de soporte que hacen que el laboratorio sea funcional, observable, seguro y f\u00e1cil de usar.</p> <p>Casi todos estos servicios se ejecutan como contenedores con Docker en los servidores Debian, Excepto el Basti\u00f3n y el Samba DC.</p> <ul> <li>NetBox (Source of Truth): La base de datos de qu\u00e9 existe en la red.</li> <li>Uptime Kuma (Monitoreo): El dashboard de monitoreo de los equipos de la topolog\u00eda y servicios.</li> <li>Bastion (Jump Server): El punto de acceso seguro SSH a la red.</li> <li>Samba AD DC (Identity Provider): El servicio de directorio y Controlador de Dominio para la autenticaci\u00f3n centralizada (Kerberos/LDAP).</li> <li>Grafana &amp; Prometheus (Observabilidad): El stack para la recolecci\u00f3n de m\u00e9tricas hist\u00f3ricas SNMP (Tr\u00e1fico, CPU, RAM) y visualizaci\u00f3n de datos en tiempo real.</li> </ul>"},{"location":"servicios/bastion/","title":"Bastion (Jump Server)","text":""},{"location":"servicios/bastion/#bastion-jump-server","title":"Bastion (Jump Server)","text":"<p>El servidor bastion (tambi\u00e9n conocido como \"jump server\") es un componente de seguridad importante en la topolog\u00eda. Act\u00faa como la \u00fanica puerta de entrada autorizada a la red de gesti\u00f3n (<code>172.16.10.0/24</code>) desde redes externas o menos seguras.</p>"},{"location":"servicios/bastion/#1-proposito-y-diseno-de-seguridad","title":"1. Prop\u00f3sito y Dise\u00f1o de Seguridad","text":"<p>El problema: Los dispositivos de red (routers, switches) no deben ser accesibles directamente desde cualquier red. Exponer SSH de un router a una red de usuarios o a Internet es un riesgo de seguridad enorme.</p> <p>La soluci\u00f3n:</p> <ol> <li>Aislamiento: Las interfaces de gesti\u00f3n de los routers y switches (ej. <code>JPROO2</code>, <code>JPSWC01</code>) solo tienen conectividad por SSH en la VLAN de Sysadmin (<code>172.16.10.0/24</code>). </li> </ol> <p>Esta es la configuraci\u00f3n que se debe de aplicar en los router y switches de la topolog\u00eda, creando una access-list: </p><pre><code>  conf t\n  ip access-list standard ADMIN_ONLY\n  permit host 172.16.10.10 !Ip del servidor de basti\u00f3n\n  line vty 0 4\n  access-class ADMIN_ONLY in\n  exit\n</code></pre><p></p> <ol> <li> <p>Acceso Remoto Seguro (Tailscale):     Se utiliza Tailscale (una VPN) para el acceso remoto. El servicio de Tailscale est\u00e1 activo tanto en el firewall pfSense (<code>JPFW01</code>) como en el equipo personal del administrador. Esto crea un t\u00fanel seguro sin exponer ning\u00fan puerto directamente a Internet.</p> </li> <li> <p>Punto de Acceso \u00danico (Port Forwarding):     Para acceder al bastion, se utiliza una regla de Port Forwarding (NAT) en el pfSense.</p> <ul> <li>El administrador inicia una conexi\u00f3n SSH a la IP de Tailscale del firewall pfSense.</li> <li>Una regla de Port Forwarding en pfSense captura ese tr\u00e1fico (dirigido al puerto 2222 de la interfaz Tailscale) y lo redirige a la IP interna del servidor bastion (<code>172.16.10.10</code>).</li> <li>De esta forma, el bastion sigue estando totalmente aislado en su VLAN de gesti\u00f3n, y el pfSense act\u00faa como el \u00fanico intermediario seguro.</li> </ul> </li> </ol> <p>Aqu\u00ed se puede ver el flujo de acceso completo, desde el cliente hasta el bastion:</p> <p></p>"},{"location":"servicios/bastion/#2-flujo-de-conexion","title":"2. Flujo de Conexi\u00f3n","text":"<p>Para entrar a un router por ejemplo, el administrador debe seguir este proceso:</p> <ol> <li>El administrador se conecta por SSH al servidor Bastion.</li> <li>Una vez dentro del bastion, el administrador \"salta\" (jump) al dispositivo deseado (ej. <code>ssh JPRO02-admin@172.16.1.2</code>). Aqu\u00ed entrariamos al Router cisco encargado del enrutamiento entre vlans. </li> </ol> <p>Aqu\u00ed se puede ver el flujo de acceso desde el bastion hasta el router cisco:</p> <p></p>"},{"location":"servicios/bastion/#3-configuracion-del-servidor","title":"3. Configuraci\u00f3n del Servidor","text":"<p>El bastion es un servidor Linux (Debian) m\u00ednimo, desplegado en la VLAN 10 (Sysadmin).</p> <ul> <li>Host: <code>JJUMSRV01</code> </li> <li>VLAN: 10 (Sysadmin)</li> <li>IP: <code>172.16.10.10</code></li> <li>Gateway: <code>172.16.10.1</code></li> </ul>"},{"location":"servicios/bastion/#31-compatibilidad-ssh-con-dispositivos-antiguos-cisco","title":"3.1. Compatibilidad SSH con Dispositivos Antiguos (Cisco)","text":"<p>Al intentar conectar desde el bastion (Debian moderno) a los dispositivos Cisco (con IOS antiguo), la conexi\u00f3n falla. Esto se debe a que los clientes SSH modernos han deshabilitado algoritmos de cifrado y claves de host (basados en SHA-1) que los dispositivos antiguos ofrecen, resultando en errores como:</p> <ul> <li><code>no matching key exchange method found. Their offer: diffie-hellman-group14-sha1</code></li> <li><code>no matching host key type found. Their offer: ssh-rsa</code></li> </ul> <p>Soluci\u00f3n: Para forzar al cliente SSH del bastion a aceptar estos algoritmos viejos solo para esos dispositivos, se edita el archivo <code>~/.ssh/config</code> del usuario en el servidor bastion.</p> ~/.ssh/config (en el Bastion)<pre><code># --- Configuraci\u00f3n para JPROO2 ---\nHost 10.255.255.2\n  HostName 10.255.255.2\n  User JPRO02-admin\n  KexAlgorithms +diffie-hellman-group14-sha1\n  HostKeyAlgorithms +ssh-rsa\n\n# --- Configuraci\u00f3n para JPSWC01 ---\nHost 172.16.99.10\n  HostName 172.16.99.10\n  User JPSWC01-admin\n  KexAlgorithms +diffie-hellman-group14-sha1\n  HostKeyAlgorithms +ssh-rsa\n\n# --- Configuraci\u00f3n para JPSWA01 ---\nHost 172.16.99.20\n  HostName 172.16.99.20\n  User JPSWA01-admin\n  KexAlgorithms +diffie-hellman-group14-sha1\n  HostKeyAlgorithms +ssh-rsa\n</code></pre> <p>Note</p> <p>En el caso para el router VyOS y PfSense no ser\u00eda necesario aplicar esta config en sus respectivos hostnames.</p>"},{"location":"servicios/grafana/","title":"Grafana &amp; Prometheus","text":""},{"location":"servicios/grafana/#grafana-prometheus","title":"Grafana &amp; Prometheus","text":"<p>URL de Acceso: <code>https://grafana.js-lab-uy.duckdns.org</code></p> <p>Este stack proporciona Observabilidad de la red. A diferencia de Uptime Kuma (que solo verifica si un equipo responde), este sistema recolecta m\u00e9tricas hist\u00f3ricas detalladas: consumo de ancho de banda, carga de CPU por n\u00facleo, uso de memoria RAM y estabilidad de las peticiones SNMP.</p> <p>Este servicio se ejecuta en una instancia de Oracle Cloud Infrastructure (OCI), fuera de la red local en GNS3 del laboratorio.</p> <p>La conexi\u00f3n con los dispositivos locales se realiza a trav\u00e9s de un t\u00fanel Tailscale.</p>"},{"location":"servicios/grafana/#arquitectura-de-red","title":"Arquitectura de Red","text":"<ul> <li>No hay puertos expuestos a Internet: Los puertos 3000 (Grafana) y 9090 (Prometheus) no est\u00e1n abiertos en el firewall de Oracle.</li> <li>Acceso P\u00fablico y VPN: Para ver los dashboards en grafana se expone publicamente el endpoint <code>https://grafana.js-lab-uy.duckdns.org</code>, mientras que para acceder a prometheus y snmp exporter, es obligatorio estar conectado a la red Tailscale.</li> <li>Recolecci\u00f3n de Datos: Prometheus (en la nube) alcanza las IPs privadas de la LAN (<code>192.168.1.x</code>) enrutando el tr\u00e1fico a trav\u00e9s del nodo Tailscale local (Subnet Router).</li> </ul> <p>Capturas de pantalla de los Switches (JPSWA01, JPSWC01) de la topolog\u00eda</p> <p></p> <p></p>"},{"location":"servicios/grafana/#pasos-que-realice-para-la-configuracion-e-implementacion","title":"Pasos que realic\u00e9 para la configuraci\u00f3n e implementaci\u00f3n","text":"<p>Primero ejecutamos un apt update para actualizar los paquetes del sistema:</p> <pre><code>sudo apt update -y\n</code></pre> <p>Una vez actualizados los paquetes, ya podemos instalar tailscale desde la p\u00e1gina oficial https://tailscale.com/download:</p> <pre><code>curl -fsSL [https://tailscale.com/install.sh](https://tailscale.com/install.sh) | sh\n</code></pre> <p>Ahora podemos ejecutar el comando sudo tailscale up:</p> <pre><code>sudo tailscale up\n</code></pre> <p>Hacemos click en el enlace:</p> <p></p> <p>Nos pedir\u00e1 que ingresemos una cuenta personal y una vez seleccionada, nuestra m\u00e1quina virtual de oracle estar\u00e1 dentro de nuestra tailnet.</p> <p>Luego por la consola debemos aceptar las rutas que est\u00e1 compartiendo/advirtiendo el firewall PfSense:</p> <p></p> <p>Aceptamos las rutas en la instancia de oracle con el comando:</p> <pre><code>sudo tailscale set --accept-routes\n</code></pre> <p>Posteriormente ya podremos hacerle ping a la interfaz de loopback que tiene nuestro router JPRO02, de nuestra topolog\u00eda local en GNS3:</p> <p></p> <p>Una vez actualizado el sistema e instalado tailscale debemos instalar el paquete <code>snmp</code>  que contiene la herramienta <code>snmpwalk</code>:</p> <pre><code>sudo apt install snmp\n</code></pre> <p>Entonces ahora si podemos utilizar la herramienta <code>snmpwalk</code>.</p> <p>En un dispositivo remoto de nuestra red interna, por ejemplo el PfSense se parametriza as\u00ed:</p> <pre><code>snmpwalk -v 2c -c public 192.168.1.1\n</code></pre> <ul> <li><code>v</code>: Especifica la versi\u00f3n de SNMP (1, 2c, o 3). En este caso configuramos en todos los equipos para que utilice la segunda versi\u00f3n.</li> <li><code>c</code>: La cadena comunitaria (community string), como <code>public</code> o <code>private</code>. En este caso es public.</li> <li><code>IP_o_Hostname</code>: La direcci\u00f3n del dispositivo a consultar.</li> </ul> <p>Luego de esto crearemos una carpeta donde estar\u00e1n el archivo compose para snmp_exporter que desplegaremos con docker:</p> <pre><code>sudo mkdir -p /opt/docker/snmp-exporter\n</code></pre> <p>Ahora si ya podemos crear nuestro archivo docker-compose con cualquier editor de texto, y pegamos este fragmento en esta ruta /opt/docker/snmp-exporter:</p> <pre><code>services:\n  snmp-exporter:\n    container_name: snmp-exporter\n    image: prom/snmp-exporter:v0.30.1\n    ports:\n      - 9116:9116\n    volumes:\n      - ./config:/etc/snmp-exporter\n    command: --config.file=/etc/snmp-exporter/snmp.yml\n    restart: unless-stopped\n    networks:\n      - monitoring_network\n\nnetworks:\n  monitoring_network:\n    external: true\n</code></pre> <p>Una vez guardado los cambios del docker-compose.yml, ahora podemos volver a nuestro directorio home y ya podemos clonar el repositorio con el proyecto llamado generador snmp, el cual nos ayudar\u00e1 much\u00edsimo para generar nuestra configuraci\u00f3n SNMP que necesitamos para alimentar a nuestro contenedor:</p> <p>Primero creamos un directorio y nos movemos a el:</p> <pre><code>mkdir monitoring-snmp &amp;&amp; cd monitoring-snmp\n</code></pre> <p>Dentro de ese directorio clonamos el repositorio de github:</p> <pre><code>git clone https://github.com/prometheus/snmp_exporter.git\n</code></pre> <p>Una vez clonado el repositorio dentro de la carpeta snmp_exporter tendremos todo el c\u00f3digo fuente para el generador, aunque primero necesitaremos instalar algunas dependencias para poder compilar el generador:</p> <pre><code>sudo apt-get install unzip build-essential libsnmp-dev -y\n</code></pre> <p>Nos movemos a la carpeta generator ahora:</p> <pre><code>cd generator\n</code></pre> <p></p> <p>Ahora ya podemos  compilar el generador y procesar los MIBs. Para entender la importancia de esto, pensemos en los MIBs  como si fueran el sistema DNS de las redes o un diccionario de traducci\u00f3n.</p> <p>Los dispositivos de red se comunican internamente utilizando OIDs (Object Identifiers), que son largas cadenas num\u00e9ricas jer\u00e1rquicas dif\u00edciles de memorizar para un humano. Los archivos MIB act\u00faan como un mapa que traduce esas cadenas num\u00e9ricas a nombres legibles (por ejemplo, traduce <code>.1.3.6.1.2.1.1.5.0</code> a <code>sysName</code>). Al compilar los MIBs, permitimos que el generador entienda qu\u00e9 m\u00e9tricas estamos solicitando por su nombre y sepa exactamente qu\u00e9 direcci\u00f3n num\u00e9rica pedirle al dispositivo. Esto nos ayuda a trabajar \u00fanicamente con los nombres de las m\u00e9tricas definidos en los MIBs, sin necesidad de memorizar o buscar manualmente la compleja cadena num\u00e9rica de cada OID.</p> <p>Entonces se ejecuta el siguiente comando:</p> <pre><code>make generator mibs\n</code></pre> <p>Entonces cuando tengamos el compilador en funcionamiento, ya podremos generar nuestra configuraci\u00f3n SNMP, se crear\u00e1 un binario.</p> <p>En caso de que tire un error como este por ejemplo:</p> <p></p> <p>Primero verificamos si tenemos go instalado, en caso que no, lo instalamos:</p> <p></p> <p>Y para eso lo que hacemos es descargar la versi\u00f3n 1.23.5 utilizando wget, es necesaria esa versi\u00f3n para garantizar la compatibilidad con el c\u00f3digo del repositorio:</p> <pre><code>wget https://go.dev/dl/go1.23.5.linux-amd64.tar.gz\n</code></pre> <p>Entonces lo descomprimimos ahora:</p> <pre><code>sudo tar -C /usr/local -xzf go1.23.5.linux-amd64.tar.gz\n</code></pre> <p>Agregamos /usr/local/go/bin a la variable de entorno PATH:</p> <pre><code>export PATH=$PATH:/usr/local/go/bin\n</code></pre> <p>Y si escribimos go version nos mostrar\u00e1 la version instalada:</p> <pre><code>ubuntu@JMONSR02:~/monitoring-snmp/snmp_exporter/generator$ go version\ngo version go1.24.0 linux/amd64\n</code></pre> <p>Una vez instalado go, ya podremos lanzar de nuevo el comando:</p> <pre><code>make generator mibs\n</code></pre> <p>El cu\u00e1l nos generar\u00e1 el binario compilado y listo para usar:</p> <p></p> <p>Ahora ya podemos crear nuestra configuraci\u00f3n SNMP, editando el archivo generator.yml, por las dudas hacemos una copia de ese archivo:</p> <pre><code>cp generator.yml generator.yml.bkp\n</code></pre> <p>Lo editamos con cualquier editor de texto:</p> <p></p> <p>En nuestro caso podemos dejar la autenticaci\u00f3n por defecto que ya trae, para este caso configuramos la versi\u00f3n 2 para todos los dispositivos de la red.</p> <p>Entonces debemos establecer el recorrido y poner las m\u00e9tricas espec\u00edficas que se quieran obtener, por ejemplo:</p> <p></p> generator.yml<pre><code>---\nauths:\n  public_v2:\n    version: 2\n\nmodules:\n  # M\u00d3DULO PARA VyOS, pfSense y Linux\n  nix_device:\n    walk:\n      - \"SNMPv2-MIB::sysUpTime\"              # UpTime\n      - \"SNMPv2-MIB::sysName\"                # Name\n      - \"IF-MIB::ifXTable\"                   # 64 bits meter\n      - \"HOST-RESOURCES-MIB::hrProcessorLoad\" # CPU load\n      - \"HOST-RESOURCES-MIB::hrStorageTable\"  # RAM, Disks\n    lookups:\n      - source_indexes: [ifIndex]\n        lookup: \"IF-MIB::ifName\"\n      - source_indexes: [ifIndex]\n        lookup: \"IF-MIB::ifAlias\"\n      - source_indexes: [hrStorageIndex]\n        lookup: hrStorageDescr\n        drop_source_indexes: false\n    overrides:\n      ifAlias:\n        ignore: true # Lookup metric\n      ifDescr:\n        ignore: true # Lookup metric\n      ifName:\n        ignore: true # Lookup metric\n\n  # M\u00d3DULO PARA EQUIPOS CISCO (Router y Switch)\n  cisco_device:\n    walk:\n      - \"SNMPv2-MIB::sysUpTime\"\n      - \"SNMPv2-MIB::sysName\"\n      - \"IF-MIB::ifXTable\"\n      - \"CISCO-PROCESS-MIB::cpmCPUTotal5minRev\"\n      - \"CISCO-MEMORY-POOL-MIB::ciscoMemoryPoolFree\"\n      - \"CISCO-MEMORY-POOL-MIB::ciscoMemoryPoolUsed\"\n      - \"OLD-CISCO-SYS-MIB::avgBusy5\"\n      - \"OLD-CISCO-SYS-MIB::freeMem\"\n    lookups:\n      - source_indexes: [ifIndex]\n        lookup: \"IF-MIB::ifName\"\n      - source_indexes: [ifIndex]\n        lookup: \"IF-MIB::ifAlias\"\n    overrides:\n      ifAlias:\n        ignore: true # Lookup metric\n      ifDescr:\n        ignore: true # Lookup metric\n      ifName:\n        ignore: true # Lookup metric\n</code></pre> <p>donde cada una tiene un significado en especial:</p>"},{"location":"servicios/grafana/#informacion-del-sistema-y-red","title":"Informaci\u00f3n del Sistema y Red","text":"<ul> <li>sysUpTime: Tiempo encendido (dispositivo).</li> <li>sysName: Nombre de host configurado en el dispositivo.</li> </ul>"},{"location":"servicios/grafana/#interfaces-y-trafico-comun-para-ambos","title":"Interfaces y Tr\u00e1fico (Com\u00fan para ambos)","text":"<ul> <li> <p>ifXTable: Tabla extendida de interfaces.</p> <p>Nota: Al traer esta tabla, obtienes autom\u00e1ticamente <code>ifHCInOctets</code> y <code>ifHCOutOctets</code> (los contadores de 64 bits necesarios para medir velocidades de 1Gbps o m\u00e1s sin errores).</p> <p>Tambi\u00e9n trae: <code>ifName</code> (Nombre de la interfaz) y <code>ifAlias</code> (Descripci\u00f3n de la interfaz).</p> </li> <li> <p>ifHCInOctets: Tr\u00e1fico entrante (bytes).</p> </li> <li>ifHCOutOctets: Tr\u00e1fico saliente (bytes).</li> <li>ifName: Nombre de la interfaz.</li> <li>ifAlias: Descripci\u00f3n de la interfaz.</li> </ul>"},{"location":"servicios/grafana/#modulo-vyos-linux-nix_device","title":"M\u00f3dulo VyOS / Linux (nix_device)","text":"<ul> <li> <p>hrProcessorLoad: Carga del procesador.</p> <ul> <li>Detalle: Muestra el % de uso de cada n\u00facleo de la CPU individualmente.</li> </ul> </li> <li> <p>hrStorageTable: Tabla de almacenamiento unificada.</p> <ul> <li>Detalle: En Linux/VyOS, esto incluye tanto Discos Duros (sistema de archivos) como Memoria RAM (Physical memory). Por eso usamos filtros luego para separarlos.</li> </ul> </li> </ul>"},{"location":"servicios/grafana/#modulo-cisco-cisco_device","title":"M\u00f3dulo Cisco (cisco_device)","text":"<ul> <li> <p>cpmCPUTotal5minRev: Uso de CPU (Cisco Moderno).</p> <ul> <li>Detalle: Promedio de uso de CPU en los \u00faltimos 5 minutos (Est\u00e1ndar recomendado para Cisco).</li> </ul> </li> <li> <p>ciscoMemoryPoolFree: Memoria Libre (Cisco Moderno).</p> <ul> <li>Detalle: Cantidad de bytes libres en el pool de memoria.</li> </ul> </li> <li> <p>ciscoMemoryPoolUsed: Memoria Usada (Cisco Moderno).</p> <ul> <li>Detalle: Cantidad de bytes ocupados.</li> </ul> </li> <li> <p>avgBusy5: Uso de CPU (Cisco Legacy).</p> <ul> <li>Detalle: M\u00e9trica antigua para routers viejos que no soportan la MIB moderna.</li> </ul> </li> <li> <p>freeMem: Memoria Libre (Cisco Legacy).</p> <ul> <li>Detalle: La m\u00e9trica \"vieja\" para equipos que no soportan MemoryPool.</li> </ul> </li> </ul> <p>Ahora cerramos y guardamos el archivo, y ya podremos ejecutar el generador:</p> <pre><code>./generator -m mibs generate\n</code></pre> <p>Esto nos generar\u00e1 un archivo llamado snmp.yml:</p> <p></p> <p>Bien entonces el siguiente paso es levantar el contenedor y la configuraci\u00f3n, para eso volvemos al directorio: </p> <pre><code>cd /opt/docker/snmp-exporter\n</code></pre> <p>Y antes de iniciar el contenedor, crearemos una carpeta llamada config:</p> <pre><code>mkdir config \n</code></pre> <p>Luego, lo que hacemos es copiar el archivo snmp.yml que se gener\u00f3 automaticamente a la ubicaci\u00f3n actual, el directorio config:</p> <pre><code>sudo cp /home/ubuntu/monitoring-snmp/snmp_exporter/generator/snmp.yml  .\n</code></pre> <p>Ahora ya podemos crear la carpeta prometheus y su compose dentro de /opt/docker/:</p> <pre><code>mkdir prometheus &amp;&amp; cd prometheus\n</code></pre> <p>Creamos el archivo docker-compose.yml utilizando cualquier editor de texto, y pegamos lo siguiente:</p> <pre><code>services:\n  prometheus:\n    image: prom/prometheus:v3.9.1\n    container_name: prometheus\n    ports:\n      - 9090:9090\n    volumes:\n      - ./prometheus:/etc/prometheus\n      - ./prometheus-data:/prometheus\n    command: \"--config.file=/etc/prometheus/prometheus.yml\"\n    restart: unless-stopped\n    networks:\n      - monitoring_network\n\nnetworks:\n  monitoring_network:\n    driver: bridge\n    name: monitoring_network\n</code></pre> <p>Luego creamos una carpeta llamada prometheus-data:</p> <pre><code>mkdir prometheus-data\n</code></pre> <p>Le otorgamos permisos de lectura, escritura y ejecuci\u00f3n:</p> <pre><code>chmod 777 prometheus-data\n</code></pre> <p>Y ahora dentro de /opt/docker/prometheus, creamos otra carpeta prometheus que contendr\u00e1 el prometheus.yml:</p> <pre><code>mkdir prometheus &amp;&amp; cd prometheus\n</code></pre> <p>Posteriormente utilizando creamos el archivo prometheus.yml y pegamos el siguiente contenido:</p> <pre><code>global:\n  scrape_interval: 30s\n\nscrape_configs:\n  # JOB 1: Equipos VyOS y PfSense\n  - job_name: 'Vyos and PfSense'\n    scrape_interval: 60s      # Escanea cada 1 minuto (menos carga al CPU de GNS3)\n    scrape_timeout: 30s       \n    static_configs:\n      - targets:\n        - 10.255.255.1  \n        - 192.168.1.1   \n    metrics_path: /snmp\n    params:\n      auth: [public_v2]\n      module: [nix_device]\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: snmp-exporter:9116\n\n  # JOB 2: Equipos Cisco\n  - job_name: 'Router Cisco'\n    static_configs:\n      - targets:\n        - 10.255.255.2\n    metrics_path: /snmp\n    params:\n      auth: [public_v2]\n      module: [cisco_device]\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: snmp-exporter:9116\n\n# JOB 3: Equipos Cisco\n  - job_name: 'Switches Cisco'\n    scrape_interval: 60s      \n    scrape_timeout: 30s       \n    static_configs:\n      - targets:\n        - 172.16.99.10\n        - 172.16.99.20\n    metrics_path: /snmp\n    params:\n      auth: [public_v2]\n      module: [cisco_device]\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: snmp-exporter:9116\n</code></pre> <p>Una vez guardado ahora ya podemos levantar el contenedor utilizando docker-compose:</p> <pre><code>docker-compose up -d \n</code></pre> <p></p> <p>Ahora se encuentra en ejecuci\u00f3n, y podemos ingresar a la interfaz gr\u00e1fica utilizando la ip que nos proporciona tailscale e indicamos el puerto 9090 que est\u00e1 escuchando nuestro contenedor de prometheus <code>http://100.103.72.38:9090/</code>: </p> <p></p> <p>Posteriormente ahora tambi\u00e9n ya podemos levantar el contenedor snmp_exporter que creamos en pasos anteriores:</p> <p></p> <p>Tambi\u00e9n podemos ingresar a la p\u00e1gina con la ip de tailscale y el puerto 9116 <code>http://100.103.72.38:9090/</code></p> <p></p> <p>Ahora en este paso incluso ya podemos probar si estamos obteniendo las m\u00e9tricas, entonces en target ponemos la ip de nuestro dispositivo por ejemplo 10.255.255.2 (JPRO02), en auth dejamos el public_v2 que qued\u00f3 definido desde un principio y en m\u00f3dulo escribimos cisco_device:</p> <p></p> <p>Entonces cuando le damos a Submit, nos devuelve un bloque de los datos que est\u00e1 obteniendo, esto es un peque\u00f1o fragmento de las m\u00e9tricas que estamos obteniendo de nuestro router.</p> <p>Una vez que eso est\u00e1 funcionando ya podemos volver a la carpeta /opt/docker/ y dentro de ella crearemos una llamada Grafana:</p> <pre><code>mkdir grafana &amp;&amp; cd grafana \n</code></pre> <p>Dentro de ella creamos nuestro archivo docker-compose.yml utilizando nano o vim, y pegamos el siguiente contenido:</p> <pre><code>services:\n  grafana:\n    image: grafana/grafana:12.4.0-20904407122-ubuntu\n    container_name: grafana\n    restart: unless-stopped\n    ports:\n      - '3000:3000'\n    environment:\n      GF_RENDERING_SERVER_URL: http://grafana-image-renderer:8081/render\n      GF_RENDERING_CALLBACK_URL: http://grafana:3000/\n    volumes:\n      - grafana-storage:/var/lib/grafana\n\n    networks:\n      - monitoring_network\nvolumes:\n  grafana-storage: {}\n\nnetworks:\n  monitoring_network:\n    external: true\n</code></pre> <p>Listo, ahora si podremos levantar nuestro contenedor con la herramienta <code>docker-compose up</code>:</p> <p></p> <p>Ingresando con la ip de tailscale y el puerto 3000 que est\u00e1 escuchando el contenedor de grafana, podremos acceder al dashboard desde un navegador:</p> <p></p> <p>Ahora es el momento de crear los paneles con graficas, gauge y stats, de nuesotro firewall PfSense en este caso, para eso primero debemos linkear Prometheus como fuente de datos, osea conectar Prometheus como fuente de datos en Grafana.</p> <p>Hacemos click en data sources:</p> <p></p> <p>Ahora clickeamos el bot\u00f3n azul que dice Add data source:</p> <p></p> <p>Elegimos Prometheus:</p> <p></p> <p>y en la ventana que se nos abre, en el campo connection debemos poner el nombre del contenedor de prometheus que definimos en su archivo docker-compose.yml, y tambi\u00e9n indicamos el puerto, en este caso 9090:</p> <p></p> <p>y si hacemos click en el bot\u00f3n save &amp; test:</p> <p></p> <p>Como podemos ver ya qued\u00f3 establecido prometheus como fuente de datos, ahora solo queda constuir el panel para el firewall pfsense.</p> <p>Ahora hacemos click en Dashboards y le damos en new:</p> <p></p> <p>le damos click en new visualization:</p> <p></p> <p>aqu\u00ed seleccionamos prometheus como la fuente de datos:</p> <p></p> <p>bien, ahora ya podemos comenzar a crear un panel, comenzaremos con el nombre del dispositivo, en este ejemplo lo haremos para el router cisco JPRO02 de la topolog\u00eda:</p>"},{"location":"servicios/grafana/#stat-nombre-del-dispositivo-panel","title":"Stat - Nombre del Dispositivo Panel","text":"<p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Stat</li> </ul> <p>Panel Options -&gt; Title</p> <ul> <li>Name</li> </ul> <p>Query (PromQL)</p> <pre><code>sysName{instance=\"10.255.255.2\"}\n</code></pre> <p>Options -&gt; Legend</p> <pre><code>{{sysName}}\n</code></pre>"},{"location":"servicios/grafana/#stat-tiempo-de-encendido-panel","title":"Stat - Tiempo de Encendido Panel","text":"<p>Luego para el tiempo de encendido el panel es el siguiente:</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Stat</li> </ul> <p>Panel Options -&gt; Title</p> <ul> <li>UpTime</li> </ul> <p>Query (PromQL)</p> <pre><code>sysUpTime{instance=\"10.255.255.2\"} * 10\n</code></pre> <p>Note</p> <p>aqui se multiplica por 10 porque en SNMP viene en centesimas por segundos, multiplicar por 10 lo convierte en mil\u00e9simas (Milisegundos).</p> <p>Standard options -&gt; unit -&gt; milliseconds (ms)</p>"},{"location":"servicios/grafana/#stat-pico-maximo-de-trafico-de-salida-panel","title":"Stat - Pico M\u00e1ximo de Tr\u00e1fico de Salida Panel","text":"<p>Ahora crearemos un panel que nos muestra el pico de salida (subida), m\u00e1ximo del router que tuvo en el promedio de 2 minutos</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Stat</li> </ul> <p>Panel Options -&gt; Title</p> <ul> <li>Max Outbound Traffic</li> </ul> <p>Query (PromQL)</p> <pre><code>max_over_time(sum(rate(ifHCOutOctets{instance=\"10.255.255.2\"}[2m]))[$__range:]) * 8\n</code></pre> <p>Note</p> <p>Esta query toma la velocidad de salida de todas las interfaces sumadas, busca el pico m\u00e1s alto registrado en el periodo de tiempo seleccionado y lo multiplica por 8 para mostrarlo en Bits por segundo.</p> <p>Standard options -&gt; unit -&gt; bytes (SI)</p> <p>Info</p> <p>Para el panel que muestra el m\u00e1ximo de pico de entrada se hace exactamente igual, solo que en la consulta se utiliza la siguiente:  <code>max_over_time(sum(rate(ifHCInOctets{instance=\"10.255.255.2\"}[2m]))[$__range:]) * 8</code></p>"},{"location":"servicios/grafana/#gauge-uso-de-cpu-panel","title":"Gauge - Uso de CPU Panel","text":"<p>Ahora crearemos el panel para ver el uso de la CPU del router</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Gauge</li> </ul> <p>Panel Options \u2192 Title</p> <ul> <li>CPU Usage</li> </ul> <p>Query (PromQL)</p> <pre><code>cpmCPUTotal5minRev{instance=\"10.255.255.2\"}\n</code></pre> <p>Note</p> <p>Esta m\u00e9trica representa el porcentaje de uso total de CPU, calculado como un promedio inverso de los \u00faltimos 5 minutos para el dispositivo con IP 10.255.255.2. El valor devuelto ya se encuentra normalizado en un rango de 0 a 100, por lo que es ideal para visualizarse directamente en un Gauge.</p> <p>Standard options -&gt; unit -&gt; Percent (0-100)</p> <p>Info</p> <p>Al utilizar la unidad Percent (0-100), Grafana ajusta autom\u00e1ticamente la visualizaci\u00f3n del gauge para representar correctamente el consumo de CPU, permitiendo adem\u00e1s definir umbrales (thresholds) visuales para estados normales, de advertencia o cr\u00edticos.</p> <p>Thresholds</p> <ul> <li>\ud83d\udfe2 Verde: 70 %</li> <li>\ud83d\udfe1 Amarillo: 75  %</li> <li>\ud83d\udd34 Rojo: 90 %</li> </ul> <p>Esta configuraci\u00f3n permite identificar r\u00e1pidamente estados de carga elevada de CPU.</p>"},{"location":"servicios/grafana/#gauge-uso-de-memoria-ram-panel","title":"Gauge - Uso de Memoria RAM Panel","text":"<p>Posteriormente agregaremos un panel para ver el uso de memoria ram del dispositivo</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Gauge</li> </ul> <p>Panel Options \u2192 Title</p> <ul> <li>Memory Usage</li> </ul> <p>Query (PromQL)</p> <pre><code>100 *\nsum(ciscoMemoryPoolUsed{instance=\"10.255.255.2\"})\n/\nsum(\n  ciscoMemoryPoolUsed{instance=\"10.255.255.2\"}\n  +\n  ciscoMemoryPoolFree{instance=\"10.255.255.2\"}\n)\n</code></pre> <p>Note</p> <p>Esta consulta calcula el porcentaje de uso de memoria del dispositivo con IP 10.255.255.2- La f\u00f3rmula funciona de la siguiente manera:</p> <ul> <li>Se suma toda la memoria usada (<code>ciscoMemoryPoolUsed</code>)</li> <li>Se suma la memoria total, compuesta por memoria usada + libre</li> <li>El resultado se multiplica por 100 para obtener el valor en porcentaje</li> </ul> <p>El valor final queda normalizado en un rango de 0 a 100, ideal para visualizaci\u00f3n en un panel Gauge.</p> <p>Standard options Unit -&gt; Percent (0-100)</p> <p>Info</p> <p>Al utilizar la unidad Percent (0-100), Grafana interpreta correctamente los valores como porcentaje, permitiendo adem\u00e1s aplicar umbrales visuales para identificar estados normales, de advertencia o cr\u00edticos en el consumo de memoria.</p> <p>Thresholds</p> <ul> <li>\ud83d\udfe2 Verde: 70 %</li> <li>\ud83d\udfe1 Amarillo: 75  %</li> <li>\ud83d\udd34 Rojo: 90 %</li> </ul> <p>Estos umbrales ayudan a detectar de forma temprana posibles problemas de saturaci\u00f3n de memoria.</p>"},{"location":"servicios/grafana/#time-series-trafico-de-red-panel","title":"Time series - Tr\u00e1fico de Red Panel","text":"<p>El siguiente paso es crear gr\u00e1ficos de l\u00ednea para monitorear el tr\u00e1fico de red en tiempo real.</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Time series</li> </ul> <p>Panel Options \u2192 Title</p> <ul> <li>Total Traffic</li> </ul> <p>Query (PromQL)</p> <p></p><pre><code>sum(irate(ifHCInOctets{instance=\"10.255.255.2\"}[$__rate_interval]) * 8)\n</code></pre> Legend Total in<p></p> <pre><code>sum(irate(ifHCOutOctets{instance=\"10.255.255.2\"}[$__rate_interval]) * 8)\n</code></pre> <p>Legend Total out</p> <p>Note</p> <p>Estas consultas calculan la tasa de tr\u00e1fico de red entrante y saliente en bits por segundo para el dispositivo con IP 10.255.255.2. La funci\u00f3n <code>irate()</code> estima la tasa instant\u00e1nea basada en los \u00faltimos datos disponibles, y el resultado se multiplica por 8 para convertir bytes a bits.</p> <p>Standard options Unit -&gt; bytes (SI)</p> <p>Overrides </p> <p>En el apartado de overrides, seleccionamos Fields with Name y escribimos Total Out, luego en Graph styles -&gt; Transform, seleccionamos Negative Y, y obtenemos el panel adjuntado arriba.</p> <p>Por ultimo, crearemos el dashboard que contiene el total de tr\u00e1fico pero de cada interfaz del router JPRO02, tanto entrada como salida, para obtener algo mas detallado.</p> <p></p> <p>Tipo de Visualizaci\u00f3n</p> <ul> <li>Time series</li> </ul> <p>Panel Options \u2192 Title</p> <ul> <li>Total Traffic Per Interface</li> </ul> <p>Query (PromQL)</p> <pre><code>irate(ifHCInOctets{instance=\"10.255.255.2\"}[2m]) * 8 &gt; 0\n</code></pre> <p>Legend Total in {{ifName}} </p> <pre><code>irate(ifHCOutOctets{instance=\"10.255.255.2\"}[2m]) * 8 &gt; 0\n</code></pre> <p>Legend Total out {{ifName}}</p> <p>Note</p> <p>Estas consultas calculan la tasa de tr\u00e1fico de red entrante y saliente en bits por segundo (bps) para cada interfaz del dispositivo, utilizando una ventana de 2 minutos y multiplicando por 8 para convertir de bytes a bits.</p> <p>Standard options Unit -&gt; bytes (SI)</p> <p>Overrides</p> <p></p> <p>En el apartado de overrides, seleccionamos Fields with Name y escribimos /.Out*/, luego en Graph styles -&gt; Transform, seleccionamos Negative Y, y obtenemos el panel adjuntado arriba.</p>"},{"location":"servicios/grafana/#conclusion","title":"Conclusi\u00f3n","text":"<p>\u00a1Y con esto hemos finalizado la configuraci\u00f3n del stack de Grafana y Prometheus para monitorear nuestros dispositivos de red a trav\u00e9s de SNMP! Ahora podemos visualizar m\u00e9tricas detalladas y en tiempo real sobre el rendimiento y estado de nuestros equipos directamente desde los dashboards personalizados en Grafana. Tambi\u00e9n obtendremos el mismo resultado haciendo con el resto de dispositivos de red.</p>"},{"location":"servicios/kuma/","title":"Uptime Kuma (Monitoreo)","text":""},{"location":"servicios/kuma/#uptime-kuma-monitoreo","title":"Uptime Kuma (Monitoreo)","text":"<p>URL de Acceso: <code>https://kuma.js-lab-uy.duckdns.org</code></p> <p>Uptime Kuma es un dashboard de monitoreo simple y de c\u00f3digo abierto. En nuestra topolog\u00eda nos sirve para saber si nuestros dispositivos de red est\u00e1n activos as\u00ed como tambi\u00e9n nuestras p\u00e1ginas.</p>"},{"location":"servicios/kuma/#1-proposito-monitoreo-de-servicios","title":"1. Prop\u00f3sito (Monitoreo de Servicios)","text":"<p>En nuestra topolog\u00eda, no es suficiente con \"construir\" los servicios, debemos asegurarnos de que se mantengan en l\u00ednea. Uptime Kuma nos da una vista de controlador del estado de todos los componentes cr\u00edticos del laboratorio.</p> <p>Nos alerta visualmente (y podr\u00eda enviar notificaciones) si un servicio o dispositivo se cae, permitiendo un diagn\u00f3stico r\u00e1pido.</p>"},{"location":"servicios/kuma/#2-dashboard-de-estado","title":"2. Dashboard de Estado","text":"<p>El dashboard principal centraliza el estado de todos los monitores configurados, mostrando un \"UP\" (verde) o \"DOWN\" (rojo) para cada servicio.</p> <p></p>"},{"location":"servicios/kuma/#3-monitores-clave","title":"3. Monitores Clave","text":"<p>Kuma est\u00e1 configurado para vigilar todos los componentes de la topolog\u00eda usando diferentes m\u00e9todos, estos son algunos ejemplos:</p> <ul> <li> <p>Monitores HTTP (Sitios Web):</p> <ul> <li><code>NetBox</code>: Verifica que la interfaz web de NetBox responda correctamente.</li> <li><code>Grafana</code>: Consulta que el dashboard de Grafana est\u00e9 accesible.</li> <li><code>pfSense WebGUI</code>: Verifica el estado de la interfaz de gesti\u00f3n del firewall.</li> </ul> </li> <li> <p>Monitores Ping (ICMP):</p> <ul> <li><code>Gateway pfSense (10.10.0.1)</code>: El monitor m\u00e1s cr\u00edtico. Si este se cae, la red est\u00e1 rota.</li> <li><code>Loopback JPROO2 (10.255.255.2)</code>: Verifica que el router de las VLANs est\u00e9 en l\u00ednea.</li> <li><code>Servidor Bastion (172.16.10.10)</code>: Asegura que el punto de acceso SSH est\u00e9 vivo.</li> </ul> </li> <li> <p>Monitores de Certificados SSL/TLS:</p> <ul> <li><code>https://netbox.js-lab-uy.duckdns.org/</code>: Kuma tambi\u00e9n se encarga de monitorear la fecha de vencimiento de los certificados SSL/TLS, avisando 30 d\u00edas antes de que expiren.</li> </ul> </li> </ul> <p>En esta imagen podemos ver que el certificado SSL para el endpoint https://netbox.js-lab-uy.duckdns.org/ vence en 36 d\u00edas:</p> <p></p>"},{"location":"servicios/kuma/#4-despliegue-docker","title":"4. Despliegue (Docker)","text":"<p>Uptime Kuma se ejecuta como un contenedor Docker liviano en el servidor JDATSR01 (Vlan 5 Datacenter), gestionado a trav\u00e9s de <code>docker-compose</code>.</p> docker-compose.yml<pre><code>services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1.23.16\n    container_name: uptime-kuma\n    volumes:\n      - ./uptime-kuma-data:/app/data\n    ports:\n      - 3000:3001  # &lt;Host Port&gt;:&lt;Container Port&gt;\n    restart: unless-stopped\n</code></pre>"},{"location":"servicios/netbox/","title":"NetBox (Source of Truth)","text":""},{"location":"servicios/netbox/#netbox-source-of-truth","title":"NetBox (Source of Truth)","text":"<p>URL de Acceso: <code>https://netbox.js-lab-uy.duckdns.org</code></p> <p>NetBox es una herramienta de c\u00f3digo abierto para la gesti\u00f3n de infraestructura. Es el componente m\u00e1s importante de nuestra gesti\u00f3n: act\u00faa como la fuente de confianza de nuestro laboratorio.</p>"},{"location":"servicios/netbox/#1-proposito","title":"1. Prop\u00f3sito","text":"<p>El objetivo de NetBox es reemplazar las hojas de c\u00e1lculo y la documentaci\u00f3n est\u00e1tica.</p> <p>NetBox es la base de datos central que contiene un registro de cada dispositivo, cable, VLAN y direcci\u00f3n IP que existe en la topolog\u00eda.</p>"},{"location":"servicios/netbox/#2-vistas-del-inventario","title":"2. Vistas del Inventario","text":"<p>NetBox proporciona una vista detallada y relacional de todos los componentes de la infraestructura. Las vistas m\u00e1s importantes son el IPAM (gesti\u00f3n de IPs) y el inventario de dispositivos.</p>"},{"location":"servicios/netbox/#21-dispositivos","title":"2.1 Dispositivos","text":""},{"location":"servicios/netbox/#22-vlans","title":"2.2 Vlans","text":""},{"location":"servicios/netbox/#23-prefijos","title":"2.3 Prefijos","text":""},{"location":"servicios/netbox/#24-cableado","title":"2.4 Cableado","text":""},{"location":"servicios/netbox/#3-componentes-documentados","title":"3. Componentes Documentados","text":"<p>La base de datos de NetBox ha sido poblada para reflejar exactamente la topolog\u00eda del laboratorio GNS3:</p> <ul> <li>Sitio: Se cre\u00f3 un sitio (<code>Juane Home Lab</code>) para alojar todos los dispositivos.</li> <li>Fabricantes y Modelos: Se crearon <code>Device Types</code> para <code>Cisco</code>, <code>VyOS</code>, <code>pfSense</code>, <code>Debian</code>, etc., con sus respectivas interfaces (<code>GigabitEthernet0/0</code>, <code>eth0</code>, <code>ens4</code>).</li> <li>Dispositivos: Todos los dispositivos de la topolog\u00eda (<code>JPROO1</code>, <code>JPSWA01</code>, <code>JDATSR01</code>, etc.) han sido creados y asignados a sus roles.</li> <li>VLANs y Prefijos: Todas las VLANs (1, 5, 10, 200) y subredes (Prefixes) est\u00e1n registradas.</li> <li>Cables: Todas las conexiones f\u00edsicas (virtuales) entre dispositivos en GNS3 se han replicado como \"cables\" en NetBox, conectando interfaces espec\u00edficas.</li> </ul>"},{"location":"servicios/netbox/#4-despliegue-docker","title":"4. Despliegue (Docker)","text":"<p>NetBox se ejecuta como una pila (stack) de contenedores de Docker, gestionada por <code>docker-compose</code>. Esta pila incluye la propia aplicaci\u00f3n de NetBox, una base de datos PostgreSQL y un cach\u00e9 de Redis. Para su implementaci\u00f3n se utiliz\u00f3 un repositorio p\u00fablico de github llamado NetBox-Community netbox-community.</p> docker-compose.yml<pre><code>services:\n  netbox: &amp;netbox\n    image: docker.io/netboxcommunity/netbox:${VERSION-v4.4-3.4.1}\n    depends_on:\n      - postgres\n      - redis\n      - redis-cache\n    env_file: env/netbox.env\n    user: \"unit:root\"\n    healthcheck:\n      test: curl -f http://localhost:8080/login/ || exit 1\n      start_period: 90s\n      timeout: 3s\n      interval: 15s\n    volumes:\n      - ./configuration:/etc/netbox/config:z,ro\n      - netbox-media-files:/opt/netbox/netbox/media:rw\n      - netbox-reports-files:/opt/netbox/netbox/reports:rw\n      - netbox-scripts-files:/opt/netbox/netbox/scripts:rw\n  netbox-worker:\n    &lt;&lt;: *netbox\n    depends_on:\n      netbox:\n        condition: service_healthy\n    command:\n      - /opt/netbox/venv/bin/python\n      - /opt/netbox/netbox/manage.py\n      - rqworker\n    healthcheck:\n      test: ps -aux | grep -v grep | grep -q rqworker || exit 1\n      start_period: 20s\n      timeout: 3s\n      interval: 15s\n\n  # postgres\n  postgres:\n    image: docker.io/postgres:17-alpine\n    healthcheck:\n      test: pg_isready -q -t 2 -d $$POSTGRES_DB -U $$POSTGRES_USER\n      start_period: 20s\n      timeout: 30s\n      interval: 10s\n      retries: 5\n    env_file: env/postgres.env\n    volumes:\n      - netbox-postgres-data:/var/lib/postgresql/data\n\n  # redis\n  redis:\n    image: docker.io/valkey/valkey:8.1-alpine\n    command:\n      - sh\n      - -c # this is to evaluate the $REDIS_PASSWORD from the env\n      - valkey-server --appendonly yes --requirepass $$REDIS_PASSWORD ## $$ because of docker-compose\n    healthcheck: &amp;redis-healthcheck\n      test: '[ $$(valkey-cli --pass \"$${REDIS_PASSWORD}\" ping) = ''PONG'' ]'\n      start_period: 5s\n      timeout: 3s\n      interval: 1s\n      retries: 5\n    env_file: env/redis.env\n    volumes:\n      - netbox-redis-data:/data\n  redis-cache:\n    image: docker.io/valkey/valkey:8.1-alpine\n    command:\n      - sh\n      - -c # this is to evaluate the $REDIS_PASSWORD from the env\n      - valkey-server --requirepass $$REDIS_PASSWORD ## $$ because of docker-compose\n    healthcheck: *redis-healthcheck\n    env_file: env/redis-cache.env\n    volumes:\n      - netbox-redis-cache-data:/data\n\nvolumes:\n  netbox-media-files:\n    driver: local\n  netbox-postgres-data:\n    driver: local\n  netbox-redis-cache-data:\n    driver: local\n  netbox-redis-data:\n    driver: local\n  netbox-reports-files:\n    driver: local\n  netbox-scripts-files:\n    driver: local\n</code></pre>"},{"location":"servicios/samba/","title":"Samba AD DC (Identity Provider)","text":""},{"location":"servicios/samba/#samba-ad-dc-identity-provider","title":"Samba AD DC (Identity Provider)","text":"<p>El Controlador de Dominio de Samba (Samba AD DC) nos proporciona la identidad en el laboratorio, brindando servicios de LDAP (Servicio de Directorio) y Kerberos (Autenticaci\u00f3n). Permite la autenticaci\u00f3n centralizada y el inicio de sesi\u00f3n \u00fanico para todos los hosts y servicios.</p>"},{"location":"servicios/samba/#1-aprovisionamiento-del-controlador-de-dominio-jdcsr01","title":"1. Aprovisionamiento del Controlador de Dominio (JDCSR01)","text":"<p>El servicio Samba AD DC fue levantado sobre el servidor JDCSR01 con la siguiente configuraci\u00f3n:</p> <pre><code>#!/bin/bash\n\nDOMAIN=\"JS-LAB-PY\"\nREALM=\"${DOMAIN}.DUCKDNS.ORG\"\nADMINPASSWORD=\"\"\n\nsed -i 's/127.0.0.1/8.8.8.8/' /etc/resolv.conf\n\ncp /etc/resolv.conf /etc/resolv.conf.bak\n\nsudo apt update\napt-get install acl attr samba samba-client winbind libpam-winbind libnss-winbind dnsutils python3-setproctitle krb5-user -y \n\nsystemctl stop smbd nmbd winbind\nsystemctl disable smbd nmbd winbind\nsystemctl mask smbd nmbd winbind\n\nfor VARIABLE in $(smbd -b | egrep \"LOCKDIR|STATEDIR|CACHEDIR|PRIVATE_DIR\" | cut -d \":\" -f2)\ndo\n    echo \"Borrando *.tdb y *.ldb en $VARIABLE\"\n    rm -Rf $VARIABLE/*.tdb\n    rm -Rf $VARIABLE/*.ldb\ndone\n\nrm -f $(smbd -b | grep \"CONFIGFILE\" | cut -d \":\" -f2)\necho \"etc/samba/smb.conf borrado\"\nls /etc/samba\n\nsamba-tool domain provision --server-role=dc --use-rfc2307 --dns-backend=SAMBA_INTERNAL --realm=\"${REALM}\" --domain=\"${DOMAIN}\" --adminpass=\"${ADMINPASSWORD}\"\n\nsed -i 's/8.8.8.8/127.0.0.1/' /etc/resolv.conf\n\nsystemctl unmask samba-ad-dc\nsystemctl enable samba-ad-dc\nsystemctl restart samba-ad-dc\n\nsleep 10\n\nhost -t SRV _ldap._tcp.$REALM\nhost -t SRV _kerberos._udp.$REALM\nhost -t A $(hostname).$REALM\n\nsleep 5\n</code></pre>"},{"location":"servicios/samba/#2-estructura-de-usuarios-y-grupos","title":"2. Estructura de Usuarios y Grupos","text":"<p>La estructura de AD fue creada mediante un script utilizando la herramienta <code>samba-tool</code> para estandarizar los nombres de usuario al formato nombre.apellido y organizar la red. Este script crea OUs, grupos de seguridad, asigna a los usuarios a sus respectivos grupos y organiza todo de manera jer\u00e1rquica. Adem\u00e1s, la contrase\u00f1a por defecto para los usuarios es el nombre.apellido, pero cuando se inicia sesi\u00f3n por primera vez, se les solicita cambiarla:</p> <pre><code>#!/bin/bash\n\nDOMAIN=\"JS-LAB-PY\"\nREALM=\"${DOMAIN}.DUCKDNS.ORG\"\nsamba-tool ou create \"ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\n\n# Usuarios\nsamba-tool ou create \"ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Proveedores,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Ex-Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\n\n# Service Accounts\nsamba-tool ou create \"ou=ServiceAccounts,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\n\n# Equipos\nsamba-tool ou create \"ou=Equipos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Desktops,ou=Equipos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Servers,ou=Equipos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\n\n# Grupos\nsamba-tool ou create \"ou=Grupos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\nsamba-tool ou create \"ou=Grupos Distribuidos,ou=Grupos,ou=${REALM},dc=${DOMAIN},dc=duckdns,dc=org\"\n\n\n\n# Crear grupo sysadmins\nsamba-tool group add sysadmins --groupou=\"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM}\"\n\n# Crear grupo devs\nsamba-tool group add devs --groupou=\"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM}\"\n\n# Crear grupo rrhh\nsamba-tool group add rrhh --groupou=\"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM}\"\n\n# Crear grupo proxmox-admins\nsamba-tool group add proxmox-admins --groupou=\"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM}\"\n\n# Crear grupo proveedores\nsamba-tool group add proveedores --groupou=\"ou=Grupos de Seguridad,ou=Grupos,ou=${REALM}\"\n\n# Usuarios Sysadmins\nsamba-tool user create \"carlos.martinez\" carlos.martinez --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"laura.lopez\" laura.lopez --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"juan.hernandez\" juan.hernandez --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"jesus.guibert\" jesus.guibert --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"juan.siecola\" juan.siecola --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"miguel.torres\" miguel.torres --userou=\"ou=Sysadmins,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\n\n# Usuarios Devs\nsamba-tool user create \"david.gomez\" david.gomez --userou=\"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"sandra.ramirez\" sandra.ramirez --userou=\"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"alejandro.torres\" alejandro.torres --userou=\"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"patricia.morales\" patricia.morales --userou=\"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"javier.ortiz\" javier.ortiz --userou=\"ou=Devs,ou=Sistemas,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\n# Usuarios RRHH\nsamba-tool user create \"beatriz.navarro\" beatriz.navarro --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"raul.gil\" raul.gil --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"maria.soto\" maria.soto --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"antonio.castro\" antonio.castro --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"isabel.ramos\" isabel.ramos --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"jorge.vega\" jorge.vega --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\nsamba-tool user create \"laura.mendez\" laura.mendez --userou=\"ou=RRHH,ou=Empleados,ou=Usuarios,ou=${REALM}\" --must-change-at-next-login\n\n# Agregar usuarios a grupos\nsamba-tool group addmembers proxmox-admins \"jesus.guibert,juan.siecola\"\nsamba-tool group addmembers sysadmins \"carlos.martinez,laura.lopez,juan.hernandez,jesus.guibert,juan.siecola\" \nsamba-tool group addmembers devs \"david.gomez,sandra.ramirez,alejandro.torres,patricia.morales,javier.ortiz\"\nsamba-tool group addmembers rrhh \"beatriz.navarro,raul.gil,maria.soto,antonio.castro,isabel.ramos,jorge.vega\"\nsamba-tool group addmembers proveedores \"laura.mendez,beatriz.navarro\"\n</code></pre>"},{"location":"servicios/samba/#3-union-de-equipos-al-dominio-host-linux","title":"3. Uni\u00f3n de Equipos al Dominio (Host Linux)","text":"<p>Todos los servidores Linux (JDEVSR01, JJUMSR01 y JDATSR01) se unieron al dominio utilizando realm para configurar SSSD, Kerberos y Winbind autom\u00e1ticamente.</p> <p>Este script asegura que las m\u00e1quinas puedan usar las credenciales de AD para iniciar sesi\u00f3n pot SSH por ejemplo y que se creen los directorios home autom\u00e1ticamente. El requisito principal para que funcione es que el DNS primario apunte a la IP del host que corre el servicio samba (JDCSR01).</p> <p>Note</p> <p>Como se mencion\u00f3 antes, el DNS primario de las m\u00e1quinas Linux debe apuntar a la IP del servidor Samba AD DC (JDCSR01) para que la uni\u00f3n al dominio funcione correctamente, en este caso <code>172.16.10.11</code> es la IP del servidor Samba AD DC.</p> <pre><code>#!/bin/bash\napt install sssd-ad sssd-tools realmd adcli packagekit sudo nfs-common -y\nsudo realm join js-lab-py.duckdns.org -U administrator\nsudo pam-auth-update --enable mkhomedir\n\n#Configuraci\u00f3n general de sssd\n\nsudo cat &lt;&lt; EOF | sudo tee /etc/sssd/sssd.conf\n[sssd]\ndomains = JS-LAB-PY.DUCKDNS.ORG\nconfig_file_version = 2\nservices = nss, pam\n\n[domain/JS-LAB-PY.DUCKDNS.ORG]\ndefault_shell = /bin/bash\nkrb5_store_password_if_offline = True\ncache_credentials = True\nkrb5_realm = JS-LAB-PY.DUCKDNS.ORG\nrealmd_tags = manages-system joined-with-adcli\nid_provider = ad\nfallback_homedir = /home/%u@%d\nad_domain = JS-LAB-PY.DUCKDNS.ORG\nldap_id_mapping = True\naccess_provider = ad\nad_enable_gc = False\nldap_user_ssh_public_key = sshPublicKey\nldap_user_extra_attrs = sshPublicKey:sshPublicKey\nEOF\n\nsleep 5\nsudo systemctl restart sssd\n</code></pre>"},{"location":"servicios/samba/#4-demostracion-en-una-maquina-con-windows-10","title":"4. Demostraci\u00f3n en una m\u00e1quina con Windows 10.","text":"<p>Para unir una m\u00e1quina con Windows 10 al dominio Samba AD DC:</p>"},{"location":"topologia/diagrama/","title":"Diagrama General de la Topolog\u00eda","text":""},{"location":"topologia/diagrama/#diagrama-general-de-la-topologia","title":"Diagrama General de la Topolog\u00eda","text":"<p>A continuaci\u00f3n se muestra la topolog\u00eda simulada en GNS3, la cu\u00e1l tiene conectividad mediante Tailscale a una m\u00e1quina virtual de AWS y OCI (Oracle Cloud Infraestructure). La misma incluye un router Cisco y VyOS, switches Cisco, un firewall PfSense y servidores Debian 12. Tambi\u00e9n se muestra con un icono el servicio de docker desplegado en cada server, el servidor de basti\u00f3n y el Samba DC.</p> <p></p>"},{"location":"topologia/direccionamiento/","title":"Direccionamiento","text":""},{"location":"topologia/direccionamiento/#tabla-de-direccionamiento-de-las-subredes","title":"Tabla de direccionamiento de las subredes","text":"Prop\u00f3sito / Red VLAN ID Red (Subred) M\u00e1scara (CIDR) Gateway Administrative Switches 99 172.16.99.0 /24 172.16.99.1 Datacenter 5 172.16.5.0 /24 172.16.5.1 Dev 200 172.16.200.0 /24 172.16.200.1 Sysadmin 10 172.16.10.0 /24 172.16.10.1 Management N/A 192.168.1.0 /24 192.168.1.1 Enlace (JPROO1-JPROO2) N/A 10.10.1.0 /30 N/A Enlace (JPROO1-JPFW01) N/A 10.10.0.0 /30 N/A"},{"location":"topologia/direcciones-ip/","title":"Direccionamiento IP por Interfaz","text":""},{"location":"topologia/direcciones-ip/#direccionamiento-ip-por-interfaz","title":"Direccionamiento IP por Interfaz","text":"<p>Esta p\u00e1gina sirve como un inventario detallado de todas las direcciones IP asignadas a las interfaces de los dispositivos de red y servidores.</p>"},{"location":"topologia/direcciones-ip/#1-routers-y-firewall","title":"1. Routers y Firewall","text":""},{"location":"topologia/direcciones-ip/#jproo2-router-cisco","title":"JPROO2 (Router Cisco)","text":"<p>Este router maneja el enrutamiento Inter-VLAN (Router-on-a-Stick).</p> Interfaz Descripci\u00f3n VLAN Direcci\u00f3n IP M\u00e1scara (CIDR) G0/3.5 Gateway VLAN 5 (Datacenter) 5 172.16.5.1 /24 G0/3.10 Gateway VLAN 10 (Sysadmin) 10 172.16.10.1 /24 G0/3.99 Gateway VLAN 99 (Admin Switches) 99 172.16.99.1 /24 G0/3.200 Gateway VLAN 200 (Dev) 200 172.16.200.1 /24 G0/0 Enlace a JPROO1 (VyOS) N/A 10.10.1.2 /30 LoopBack Administraci\u00f3n N/A 10.255.255.2 /32"},{"location":"topologia/direcciones-ip/#jproo1-router-vyos","title":"JPROO1 (Router VyOS)","text":"<p>Este router act\u00faa como el n\u00facleo de la red, conectando el router Cisco con el firewall.</p> Interfaz Descripci\u00f3n Direcci\u00f3n IP M\u00e1scara (CIDR) eth1 Enlace a JPROO2 (Cisco) 10.10.1.1 /30 eth0 Enlace a JPFW01 (pfSense) 10.10.0.2 /30 LoopBack Administraci\u00f3n 10.255.255.1 /32"},{"location":"topologia/direcciones-ip/#jpfw01-firewall-pfsense","title":"JPFW01 (Firewall pfSense)","text":"<p>Este es el dispositivo de borde, encargado del NAT y la seguridad.</p> Interfaz Prop\u00f3sito Red Direcci\u00f3n IP M\u00e1scara (CIDR) em2 Conexi\u00f3n a JPROO1 Enlace 10.10.0.1 /30 em1 Red de Management Management 192.168.1.1 /24 em0 Conexi\u00f3n a Internet (WAN) WAN DHCP N/A Tailscale0 Conexi\u00f3n VPN para compartir rutas Tailscale 100.127.26.75 N/A"},{"location":"topologia/direcciones-ip/#2-gestion-de-red-switches","title":"2. Gesti\u00f3n de Red (Switches)","text":"<p>Para poder administrar los switches por SSH necesitamos una IP, en los Routers por ejemplo usamos la IP asignada en la interfaz de loopback, pero estos necesitan una IP en una VLAN de gesti\u00f3n. </p> Dispositivo Prop\u00f3sito VLAN Direcci\u00f3n IP Gateway JPSWC01 IP de Gesti\u00f3n 99 172.16.99.10 172.16.99.1 (Router Cisco) JPSWA01 IP de Gesti\u00f3n 99 172.16.99.20 172.16.99.1 (Router Cisco)"},{"location":"topologia/direcciones-ip/#3-servidores-y-hosts","title":"3. Servidores y Hosts","text":"<p>Estos son los dispositivos finales en cada red.</p> Host Red (VLAN) Interfaz Direcci\u00f3n IP Gateway JDATSR01 Datacenter (5) ens4 172.16.5.100 172.16.5.1 JDEVSR01 Dev (200) ens4 172.16.200.50 172.16.200.1 JJUMSR01 Sysadmin (10) ens4 172.16.10.10 172.16.10.1 JDCSR01 Sysadmin (10) ens4 172.16.10.11 172.16.10.1 JPPC01 Management (N/A) eth0 192.168.1.50 192.168.1.1"},{"location":"topologia/routing/","title":"Protocolos de Enrutamiento","text":""},{"location":"topologia/routing/#protocolos-de-enrutamiento","title":"Protocolos de Enrutamiento","text":""},{"location":"topologia/routing/#1-introduccion","title":"1. Introducci\u00f3n","text":"<p>El enrutamiento es el proceso de dirigir el tr\u00e1fico entre las diferentes subredes. En esta topolog\u00eda, el enrutamiento cumple tres funciones principales:</p> <ol> <li>Enrutamiento Inter-VLAN: Permitir que las VLANs (Datacenter, Dev, Sysadmin) se comuniquen entre s\u00ed.</li> <li>Enrutamiento Core: Interconectar las red VLANs con la red de servicios (Firewall y Management).</li> <li>Enrutamiento a Internet: Proveer una ruta por defecto (Default Route) y Traducci\u00f3n de Direcciones de Red (NAT) para que los hosts internos accedan a Internet.</li> </ol> <p>Dispositivos de Enrutamiento:</p> <ul> <li><code>JPROO2</code> (Router Cisco): Se encarga del \"Router-on-a-Stick\" y es el gateway de todas las VLANs.</li> <li><code>JPROO1</code> (Router VyOS): Act\u00faa como router \"core\" o de tr\u00e1nsito, conectando el router Cisco con el firewall.</li> <li><code>JPFW01</code> (Firewall): Es el firewall de borde. Se encarga de la seguridad y del NAT para salir a Internet.</li> </ul>"},{"location":"topologia/routing/#2-enrutamiento-inter-vlan-router-on-a-stick","title":"2. Enrutamiento Inter-VLAN (Router-on-a-Stick)","text":"<p>El enrutamiento entre las VLANs de la red (1, 5, 10, 200) se maneja en el router Cisco <code>JPROO2</code> usando la t\u00e9cnica Router-on-a-Stick.</p> <ul> <li>Dispositivo: <code>JPROO2</code></li> <li>Interfaz F\u00edsica: <code>GigabitEthernet0/0</code></li> <li>Concepto: Se crean sub-interfaces l\u00f3gicas en <code>G0/0</code>, una por cada VLAN. Cada sub-interfaz se etiqueta con el ID de la VLAN (usando <code>encapsulation dot1q [vlan-id]</code>) y se le asigna la direcci\u00f3n IP del gateway para esa subred.</li> </ul> <pre><code>show ip interface brief\nInterface                  IP-Address      OK? Method Status                Protocol\nGigabitEthernet0/0         10.10.1.2       YES NVRAM  up                    up\nGigabitEthernet0/1         unassigned      YES NVRAM  administratively down down\nGigabitEthernet0/2         unassigned      YES NVRAM  administratively down down\nGigabitEthernet0/3         unassigned      YES NVRAM  up                    up\nGigabitEthernet0/3.5       172.16.5.1      YES NVRAM  up                    up\nGigabitEthernet0/3.10      172.16.10.1     YES NVRAM  up                    up\nGigabitEthernet0/3.99      172.16.99.1     YES NVRAM  up                    up\nGigabitEthernet0/3.200     172.16.200.1    YES NVRAM  up                    up\nLoopback0                  10.255.255.2    YES NVRAM  up                    up\n</code></pre> <p>Nota: La configuraci\u00f3n detallada de las sub-interfaces se encuentra en la p\u00e1gina de Configuraci\u00f3n de VLANs.</p>"},{"location":"topologia/routing/#3-enrutamiento-core-jproo2-jproo1","title":"3. Enrutamiento Core (JPROO2  JPROO1)","text":"<p>Esta es la conexi\u00f3n entre los dos routers principales sobre la red <code>10.10.1.0/30</code>.</p> <p>Para intercambiar rutas autom\u00e1ticamente entre los routers <code>JPROO2</code> (Cisco) y <code>JPROO1</code> (VyOS), se utiliza el protocolo de enrutamiento din\u00e1mico OSPF (Open Shortest Path First).</p>"},{"location":"topologia/routing/#31-configuracion-en-jproo2-cisco","title":"3.1 Configuraci\u00f3n en <code>JPROO2</code> (Cisco)","text":"<p><code>JPROO2</code> se configura para \"anunciar\" en OSPF todas sus redes conectadas directamente:</p> <ol> <li>Las redes de las VLANs (desde las sub-interfaces).</li> <li>La red del enlace vecino (hacia <code>JPROO1</code>).</li> <li>Tiene una ruta est\u00e1tica por defecto (<code>0.0.0.0/0</code>) que apunta al router vyos <code>JPRO01</code> (en <code>10.10.1.1</code>). </li> </ol> Configuraci\u00f3n OSPF en JPROO2 (Cisco) y Static Route<pre><code>router ospf 1\n network 10.10.1.0 0.0.0.3 area 10\n network 10.255.255.2 0.0.0.0 area 10\n network 172.16.5.0 0.0.0.255 area 10\n network 172.16.10.0 0.0.0.255 area 10\n network 172.16.99.0 0.0.0.255 area 10\n network 172.16.200.0 0.0.0.255 area 10\n\n ! Ruta est\u00e1tica (hacia JPROO1)\n ip route 0.0.0.0 0.0.0.0 10.10.1.1\n</code></pre>"},{"location":"topologia/routing/#32-configuracion-en-jproo1-vyos","title":"3.2 Configuraci\u00f3n en <code>JPROO1</code> (VyOS)","text":"<ol> <li>Publica su enlace con <code>JPROO2</code> (la red <code>10.10.1.0/30</code>).</li> <li>Publica su enlace con <code>JPFW01</code> (la red <code>10.10.0.0/30</code>)</li> <li>Tiene una ruta est\u00e1tica por defecto (<code>0.0.0.0/0</code>) que apunta al firewall <code>JPFW01</code> (en <code>10.10.0.1</code>).</li> <li>Tiene una ruta est\u00e1tica para redirigir el tr\u00e1fico de la vlan1 para administrar y monitorear los switches por SSH y SNMP.</li> </ol> Configuraci\u00f3n de JPROO1 (VyOS)<pre><code>protocols {\n    ospf {\n     area 10 {\n         network 10.10.1.0/30\n         network 10.10.0.0/30\n         network 10.255.255.1/32\n     }\n }\n static {\n     route 0.0.0.0/0 {\n         next-hop 10.10.0.1 {\n         }\n     }\n     route 172.16.1.0/24 {\n         next-hop 10.10.1.2 {\n         }\n     }\n }\n</code></pre>"},{"location":"topologia/routing/#4-enrutamiento-de-borde-y-nat-jpfw01-pfsense","title":"4. Enrutamiento de Borde y NAT (JPFW01 - pfSense)","text":"<p><code>JPFW01</code> (pfSense) act\u00faa como el firewall de borde y el gateway principal hacia Internet. Su configuraci\u00f3n de enrutamiento es fundamental para que la red interna funcione.</p> <p>A diferencia de los routers internos que usan OSPF, el firewall se maneja principalmente con rutas est\u00e1ticas y NAT.</p>"},{"location":"topologia/routing/#41-gateway-por-defecto-salida-a-internet","title":"4.1. Gateway por Defecto (Salida a Internet)","text":"<p>El primer paso en pfSense es definir los \"gateways\" o \"pr\u00f3ximos saltos\" que el firewall conoce.</p> <p>Se necesitan dos gateways:</p> <ol> <li>Gateway por Defecto (WAN): Para salir a Internet (marcado con el ).</li> <li>Gateway Interno (HACIA_RED_INTERNA): Para saber c\u00f3mo \"devolver\" el tr\u00e1fico a la red interna a trav\u00e9s del router <code>JPROO1</code> (VyOS).</li> </ol> <p>Configuraci\u00f3n de Gateways en JPFW01: </p>"},{"location":"topologia/routing/#42-ruta-estatica-retorno-al-interior","title":"4.2. Ruta Est\u00e1tica (Retorno al Interior)","text":"<p>Cuando un paquete vuelve de Internet, pfSense lo recibe. Pero, \u00bfc\u00f3mo sabe pfSense d\u00f3nde est\u00e1n las redes <code>172.16.5.0/24</code> o <code>172.16.200.0/24</code>?</p> <p>No lo sabe. Debemos dec\u00edrselo con rutas est\u00e1ticas.</p> <p>Creamos rutas para cada una de las redes internas (VLANs) que le dicen a pfSense: \"Para alcanzar cualquier host en estas redes, env\u00eda el tr\u00e1fico de vuelta a <code>JPROO1</code> (VyOS)\" usando el gateway <code>HACIA_RED_INTERNA</code> que definimos en el paso anterior.</p> <p>Rutas Est\u00e1ticas en JPFW01: </p>"},{"location":"topologia/routing/#43-nat-saliente-outbound-nat","title":"4.3. NAT Saliente (Outbound NAT)","text":"<p>El Enrutamiento y el NAT son cosas distintas pero trabajan juntas.</p> <ol> <li>Enrutamiento: Decide hacia d\u00f3nde va un paquete.</li> <li>NAT: Cambia la direcci\u00f3n IP de origen del paquete.</li> </ol> <p>pfSense debe hacer NAT Saliente para \"esconder\" todas tus IPs privadas (172.16.x.x, 192.168.1.x, 10.10.x.x) detr\u00e1s de su \u00fanica IP p\u00fablica (la de la interfaz <code>nat0</code>/<code>WAN</code>).</p>"},{"location":"topologia/routing/#modo-hibrido-hybrid-mode","title":"Modo H\u00edbrido (Hybrid Mode)","text":"<p>Como se ve en la captura, se seleccion\u00f3 el modo \"Hybrid Outbound NAT\". </p>"},{"location":"topologia/routing/#esto-permite-en-pfsense","title":"Esto permite en PfSense:","text":"<ol> <li>Reglas Manuales: Permite crear reglas espec\u00edficas (como la regla para <code>10.10.0.0/30</code> que se ve abajo en la imagen).</li> <li>Reglas Autom\u00e1ticas: pfSense sigue generando autom\u00e1ticamente las reglas para las redes internas (VLANs, etc.) que no coincidan con una regla manual.</li> </ol>"},{"location":"topologia/routing/#reglas-automaticas","title":"Reglas Autom\u00e1ticas","text":"<p>La siguiente imagen muestra las reglas que pfSense genera autom\u00e1ticamente. La regla principal (la segunda en la lista) toma todas las redes internas (VLANs, Management, etc.) y las traduce (NAT) a la direcci\u00f3n de la <code>WAN</code> cuando salen a Internet. </p>"},{"location":"topologia/vlans/","title":"Configuraci\u00f3n de VLANs","text":""},{"location":"topologia/vlans/#configuracion-de-vlans","title":"Configuraci\u00f3n de VLANs","text":""},{"location":"topologia/vlans/#1-introduccion","title":"1. Introducci\u00f3n","text":"<p>Las VLANs (Redes de \u00c1rea Local Virtuales) se utilizan para segmentar la red en dominios de broadcast m\u00e1s peque\u00f1os. En esta topolog\u00eda, la arquitectura utilizada es Router-on-a-Stick.</p> <ul> <li> <p>El switch de acceso (JPSWA01): Utiliza puertos de acceso para asignar los dispositivos a sus respectivas VLANs y conecta con el Core mediante un enlace troncal.</p> </li> <li> <p>El switch core (JPSWC01): Agrega las conexiones utilizando puertos troncales (trunks) para permitir el paso de todas las VLANs.</p> </li> <li> <p>El router (JPROO2): Recibe el tr\u00e1fico etiquetado a trav\u00e9s de un enlace troncal y realiza el enrutamiento Inter-VLAN.</p> </li> </ul>"},{"location":"topologia/vlans/#2-tabla-de-vlans","title":"2. Tabla de VLANs","text":"VLAN ID Nombre (Prop\u00f3sito) Red (Subred) Gateway (en JPROO2) 99 Administraci\u00f3n 172.16.99.0/24 172.16.99.1 5 Datacenter 172.16.5.0/24 172.16.5.1 10 Sysadmin 172.16.10.0/24 172.16.10.1 200 Dev 172.16.200.0/24 172.16.200.1"},{"location":"topologia/vlans/#3-configuracion-del-switch-de-acceso-jpswa01","title":"3. Configuraci\u00f3n del Switch de Acceso (JPSWA01)","text":"<p><code>JPSWA01</code> es un switch Cisco de Capa 2 que conecta a los dispositivos finales pero tambi\u00e9n tiene un enlace troncal hacia <code>JPSWC01</code>.</p>"},{"location":"topologia/vlans/#puertos-de-acceso-access-ports","title":"Puertos de Acceso (Access Ports)","text":"<p>Estos puertos est\u00e1n asignados a una \u00fanica VLAN.</p> <ul> <li>Interfaz <code>G0/0</code> (Datacenter):<ul> <li>VLAN: 5</li> <li>Dispositivo: <code>JDATSR01</code></li> </ul> </li> <li>Interfaz <code>G1/0</code> (Dev):<ul> <li>VLAN: 200</li> <li>Dispositivo: <code>JDEVSR01</code></li> </ul> </li> <li>Interfaz <code>G2/0</code> y <code>G2/1</code>  (Sysadmin):<ul> <li>VLAN: 10</li> <li>Dispositivos: <code>JJUMSR01</code>, <code>JDCSR01</code></li> </ul> </li> </ul> <p>Configuraci\u00f3n del JPSWA01 </p>Salida de JPSWA01#show vlan brief<pre><code>VLAN Name                             Status    Ports\n---- -------------------------------- --------- -------------------------------\n1    default                          active    Gi0/2, Gi0/3, Gi1/1, Gi1/2, Gi1/3, Gi2/2, Gi2/3, Gi3/0, Gi3/2, Gi3/3\n5    datacenter                       active    Gi0/0, Gi0/1\n10   sysadmin                         active    Gi2/0, Gi2/1\n99   management                       active\n200  dev                              active    Gi1/0\n500  NATIVE_VLAN                      active\n1002 fddi-default                     act/unsup\n1003 token-ring-default               act/unsup\n1004 fddinet-default                  act/unsup\n1005 trnet-default                    act/unsup\n</code></pre><p></p>"},{"location":"topologia/vlans/#4-configuracion-del-switch-core-jpswc01","title":"4. Configuraci\u00f3n del Switch Core (JPSWC01)","text":"<p><code>JPSWC01</code> act\u00faa como un switch de Capa 2, agregando los enlaces troncales de la red. No realiza enrutamiento, simplemente pasa el tr\u00e1fico de todas las VLANs hacia el router.</p>"},{"location":"topologia/vlans/#puertos-troncales-trunk-ports","title":"Puertos Troncales (Trunk Ports)","text":"<ul> <li>Interfaz <code>G3/1</code>:<ul> <li>Conexi\u00f3n: Hacia <code>JPSWA01</code> (Acceso).</li> </ul> </li> <li>Interfaz <code>G0/0</code>:<ul> <li>Conexi\u00f3n: Hacia <code>JPROO2</code> (Router).</li> </ul> </li> </ul> <p>Configuraci\u00f3n de JPSWC01 </p>Salida de JPSWC01#show interfaces trunk<pre><code>Port        Mode             Encapsulation  Status        Native vlan\nGi3/0       on               802.1q         trunking      500\nGi3/1       on               802.1q         trunking      500\n\nPort        Vlans allowed on trunk\nGi3/0       1-4094\nGi3/1       1-4094\n\nPort        Vlans allowed and active in management domain\nGi3/0       1,5,10,99,200,500\nGi3/1       1,5,10,99,200,500\n\nPort        Vlans in spanning tree forwarding state and not pruned\nGi3/0       1,5,10,99,200,500\nGi3/1       1,5,10,99,200,500\n</code></pre><p></p> <p>Note</p> <p>Cabe destacar que se cambi\u00f3 la vlan nativa que suele venir por defecto en la vlan 1, a una nueva llamada NATIVE_VLAN con ID 500.</p>"}]}